<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Implementa√ß√£o Produ√ß√£o - Solu√ß√£o H√≠brida LIMPA</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .test-section { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .btn { padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; font-size: 14px; }
        .btn-primary { background: #007bff; color: white; }
        .btn-secondary { background: #6c757d; color: white; }
        .form-group { margin-bottom: 15px; }
        .form-label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 0.9rem; }
        .form-control { width: 100%; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; }
        .text-muted { color: #6c757d; font-size: 0.8rem; }
        .log-container { background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px; padding: 15px; max-height: 300px; overflow-y: auto; font-family: monospace; font-size: 12px; }
        .log-entry { margin-bottom: 5px; padding: 2px 0; }
        .log-info { color: #007bff; }
        .log-success { color: #28a745; }
        .log-warning { color: #ffc107; }
        .log-error { color: #dc3545; }
        .comparison-table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        .comparison-table th, .comparison-table td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        .comparison-table th { background: #f8f9fa; font-weight: bold; }
        .solution-highlight { background: #d4edda; border: 1px solid #c3e6cb; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; }
        .modal-content { background: white; margin: 5% auto; padding: 20px; border-radius: 8px; width: 90%; max-width: 600px; }
        .close { float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
        .close:hover { color: #999; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ Teste Implementa√ß√£o Produ√ß√£o - Solu√ß√£o H√≠brida LIMPA</h1>
            <p><strong>Problema Resolvido:</strong> Campos de data com funcionalidade h√≠brida (digita√ß√£o + calend√°rio) sem duplica√ß√£o</p>
        </div>

        <div class="test-section">
            <h2>üîß Solu√ß√£o Implementada</h2>
            <p>A solu√ß√£o implementada resolve o problema dos campos de data de forma elegante e limpa:</p>
            
            <h3>‚úÖ Caracter√≠sticas da Solu√ß√£o:</h3>
            <ul>
                <li><strong>Campo √önico:</strong> Apenas um campo de texto por data (sem duplica√ß√£o)</li>
                <li><strong>M√°scara Autom√°tica:</strong> Formato dd/mm/aaaa aplicado em tempo real</li>
                <li><strong>Calend√°rio Discreto:</strong> Bot√£o pequeno ao lado direito do campo</li>
                <li><strong>Valida√ß√£o Inteligente:</strong> Verifica datas v√°lidas automaticamente</li>
                <li><strong>UX Otimizada:</strong> Usu√°rio pode digitar OU usar calend√°rio</li>
            </ul>

            <h3>üé® Como Funciona:</h3>
            <ol>
                <li><strong>Digita√ß√£o:</strong> Usu√°rio digita n√∫meros e a m√°scara aplica automaticamente dd/mm/aaaa</li>
                <li><strong>Valida√ß√£o:</strong> Ao perder foco, valida se a data √© v√°lida</li>
                <li><strong>Calend√°rio:</strong> Bot√£o discreto ao lado abre calend√°rio nativo do navegador</li>
                <li><strong>Sincroniza√ß√£o:</strong> Data selecionada no calend√°rio √© convertida para formato brasileiro</li>
            </ol>
        </div>

        <div class="test-section">
            <h2>üìä Compara√ß√£o de Abordagens</h2>
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Abordagem</th>
                        <th>Vantagens</th>
                        <th>Desvantagens</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Campo type="date" puro</td>
                        <td>Calend√°rio nativo, valida√ß√£o autom√°tica</td>
                        <td>Formato yyyy-MM-dd, problemas de digita√ß√£o manual</td>
                        <td>‚ùå Rejeitado</td>
                    </tr>
                    <tr>
                        <td>Campo de texto com m√°scara</td>
                        <td>Formato brasileiro, digita√ß√£o f√°cil</td>
                        <td>Sem calend√°rio, valida√ß√£o manual</td>
                        <td>‚ùå Incompleto</td>
                    </tr>
                    <tr>
                        <td>Dois campos (texto + date)</td>
                        <td>Funcionalidade completa</td>
                        <td>Duplica√ß√£o, confus√£o visual, complexidade</td>
                        <td>‚ùå Rejeitado pelo usu√°rio</td>
                    </tr>
                    <tr class="solution-highlight">
                        <td><strong>Campo √∫nico h√≠brido</strong></td>
                        <td><strong>Sem duplica√ß√£o, funcionalidade completa, UX limpa</strong></td>
                        <td><strong>Implementa√ß√£o mais complexa</strong></td>
                        <td><strong>‚úÖ IMPLEMENTADO</strong></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="test-section">
            <h2>üß™ Teste Interativo</h2>
            <p>Teste a funcionalidade dos campos de data implementados:</p>
            
            <div class="form-group">
                <label class="form-label">Data de Nascimento *</label>
                <input type="text" class="form-control" id="data_nascimento" placeholder="dd/mm/aaaa" required>
                <small class="text-muted">üí° Digite dd/mm/aaaa OU clique no calend√°rio</small>
            </div>
            
            <div class="form-group">
                <label class="form-label">Validade da Credencial</label>
                <input type="text" class="form-control" id="validade_credencial" placeholder="dd/mm/aaaa">
                <small class="text-muted">üí° Digite dd/mm/aaaa OU clique no calend√°rio</small>
            </div>
            
            <div class="form-group">
                <button class="btn btn-primary" onclick="abrirModalInstrutor()">Abrir Modal de Teste</button>
                <button class="btn btn-secondary" onclick="limparLog()">Limpar Log</button>
            </div>
        </div>

        <div class="test-section">
            <h2>üìù Log de Funcionamento</h2>
            <div id="logContainer" class="log-container">
                <div class="log-entry log-info">Sistema inicializado. Campos de data configurados com funcionalidade h√≠brida.</div>
            </div>
        </div>

        <div class="test-section">
            <h2>üîç Verifica√ß√£o da Implementa√ß√£o</h2>
            <button class="btn btn-primary" onclick="verificarImplementacao()">Verificar Implementa√ß√£o</button>
            <div id="verificacaoResultado"></div>
        </div>
    </div>

    <!-- Modal de Teste -->
    <div id="modalInstrutor" class="modal">
        <div class="modal-content">
            <span class="close" onclick="fecharModalInstrutor()">&times;</span>
            <h2>Modal de Teste - Instrutor</h2>
            <p>Este modal simula o ambiente real da aplica√ß√£o para testar os campos de data.</p>
            
            <div class="form-group">
                <label class="form-label">Data de Nascimento *</label>
                <input type="text" class="form-control" id="modal_data_nascimento" placeholder="dd/mm/aaaa" required>
                <small class="text-muted">üí° Digite dd/mm/aaaa OU clique no calend√°rio</small>
            </div>
            
            <div class="form-group">
                <label class="form-label">Validade da Credencial</label>
                <input type="text" class="form-control" id="modal_validade_credencial" placeholder="dd/mm/aaaa">
                <small class="text-muted">üí° Digite dd/mm/aaaa OU clique no calend√°rio</small>
            </div>
            
            <div class="form-group">
                <button class="btn btn-primary" onclick="salvarInstrutor()">Salvar Instrutor</button>
                <button class="btn btn-secondary" onclick="fecharModalInstrutor()">Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        // Fun√ß√£o para adicionar logs
        function adicionarLog(mensagem, tipo = 'info') {
            const logContainer = document.getElementById('logContainer');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${tipo}`;
            logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${mensagem}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // Fun√ß√£o para validar se uma data √© v√°lida
        function isValidDate(dateString) {
            if (!dateString) return false;
            
            // Verificar formato yyyy-MM-dd
            const dateRegex = /^\d{4}-\d{2}-\d{2}$/;
            if (!dateRegex.test(dateString)) return false;
            
            // Verificar se √© uma data v√°lida
            const date = new Date(dateString);
            if (isNaN(date.getTime())) return false;
            
            // Verificar se a data n√£o √© muito antiga (antes de 1900)
            if (date.getFullYear() < 1900) return false;
            
            return true;
        }

        // Fun√ß√£o para configurar campos de data h√≠bridos
        function configurarCamposData() {
            const camposData = ['data_nascimento', 'validade_credencial'];
            
            camposData.forEach(campoId => {
                const campo = document.getElementById(campoId);
                
                if (campo) {
                    // Configurar campo h√≠brido (texto + calend√°rio)
                    configurarCampoDataHibrido(campoId, campo);
                }
            });
        }

        // Fun√ß√£o para configurar campo de data com m√°scara e calend√°rio discreto
        function configurarCampoDataHibrido(campoId, campo) {
            // Garantir que seja do tipo texto
            campo.type = 'text';
            
            // Criar wrapper para o campo com posicionamento relativo
            const wrapper = document.createElement('div');
            wrapper.style.position = 'relative';
            wrapper.style.display = 'inline-block';
            wrapper.style.width = '100%';
            
            // Mover o campo para dentro do wrapper
            campo.parentNode.insertBefore(wrapper, campo);
            wrapper.appendChild(campo);
            
            // Criar bot√£o do calend√°rio discreto
            const btnCalendario = document.createElement('button');
            btnCalendario.type = 'button';
            btnCalendario.innerHTML = 'üìÖ';
            btnCalendario.style.cssText = `
                position: absolute;
                right: 8px;
                top: 50%;
                transform: translateY(-50%);
                background: transparent;
                border: none;
                font-size: 14px;
                cursor: pointer;
                padding: 2px 4px;
                border-radius: 3px;
                color: #6c757d;
                z-index: 5;
                opacity: 0.7;
                transition: all 0.2s ease;
            `;
            btnCalendario.title = 'Abrir calend√°rio';
            
            // Adicionar bot√£o ao wrapper
            wrapper.appendChild(btnCalendario);
            
            // Aplicar m√°scara de data brasileira em tempo real
            campo.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                
                // Limitar a 8 d√≠gitos
                if (value.length > 8) {
                    value = value.substring(0, 8);
                }
                
                // Aplicar m√°scara dd/mm/aaaa automaticamente
                if (value.length <= 2) {
                    value = value;
                } else if (value.length <= 4) {
                    value = value.substring(0, 2) + '/' + value.substring(2);
                } else if (value.length <= 8) {
                    value = value.substring(0, 2) + '/' + value.substring(2, 4) + '/' + value.substring(4);
                }
                
                e.target.value = value;
                adicionarLog(`M√°scara aplicada: ${e.target.value}`, 'info');
            });
            
            // Validar data quando perder foco
            campo.addEventListener('blur', function() {
                const valorTexto = this.value.trim();
                if (valorTexto) {
                    if (!converterDataBrasileiraParaISO(valorTexto)) {
                        adicionarLog(`‚ùå Formato de data inv√°lido: ${valorTexto}. Use dd/mm/aaaa`, 'error');
                        this.value = '';
                        return;
                    }
                    
                    // Valida√ß√µes espec√≠ficas por campo
                    if (campoId === 'data_nascimento') {
                        const data = converterDataBrasileiraParaISO(valorTexto);
                        if (data && new Date(data) > new Date()) {
                            adicionarLog('‚ùå Data de nascimento n√£o pode ser no futuro', 'error');
                            this.value = '';
                            return;
                        }
                    }
                    
                    if (campoId === 'validade_credencial') {
                        const data = converterDataBrasileiraParaISO(valorTexto);
                        if (data && new Date(data) < new Date()) {
                            adicionarLog('‚ùå Validade da credencial deve ser no futuro', 'error');
                            this.value = '';
                            return;
                        }
                    }
                    
                    adicionarLog(`‚úÖ Data v√°lida definida no campo ${campoId}: ${valorTexto}`, 'success');
                }
            });
            
            // Permitir tecla Enter para confirmar
            campo.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    this.blur();
                }
            });
            
            // Funcionalidade do calend√°rio discreto
            btnCalendario.addEventListener('click', function() {
                adicionarLog(`üìÖ Abrindo calend√°rio para ${campoId}`, 'info');
                
                // Criar campo date tempor√°rio para o calend√°rio
                const campoDateTemp = document.createElement('input');
                campoDateTemp.type = 'date';
                campoDateTemp.style.cssText = `
                    position: absolute;
                    left: -9999px;
                    opacity: 0;
                `;
                
                // Definir valor atual se existir
                const valorAtual = campo.value.trim();
                if (valorAtual) {
                    const dataConvertida = converterDataBrasileiraParaISO(valorAtual);
                    if (dataConvertida) {
                        campoDateTemp.value = dataConvertida;
                    }
                }
                
                // Adicionar ao DOM temporariamente
                document.body.appendChild(campoDateTemp);
                
                // Focar no campo date para abrir o calend√°rio
                campoDateTemp.focus();
                campoDateTemp.click();
                
                // Listener para quando uma data for selecionada
                campoDateTemp.addEventListener('change', function() {
                    if (this.value) {
                        // Converter de volta para formato brasileiro
                        const data = new Date(this.value);
                        const dia = String(data.getDate()).padStart(2, '0');
                        const mes = String(data.getMonth() + 1).padStart(2, '0');
                        const ano = data.getFullYear();
                        const dataBrasileira = `${dia}/${mes}/${ano}`;
                        
                        // Atualizar o campo de texto
                        campo.value = dataBrasileira;
                        campo.dispatchEvent(new Event('input'));
                        campo.dispatchEvent(new Event('blur'));
                        
                        adicionarLog(`‚úÖ Data selecionada no calend√°rio: ${dataBrasileira}`, 'success');
                    }
                    
                    // Remover campo tempor√°rio
                    document.body.removeChild(campoDateTemp);
                });
                
                // Listener para quando o campo perder foco sem sele√ß√£o
                campoDateTemp.addEventListener('blur', function() {
                    setTimeout(() => {
                        if (document.body.contains(campoDateTemp)) {
                            document.body.removeChild(campoDateTemp);
                        }
                    }, 100);
                });
            });
            
            // Hover effects para o bot√£o do calend√°rio
            btnCalendario.addEventListener('mouseenter', function() {
                this.style.opacity = '1';
                this.style.backgroundColor = '#f8f9fa';
                this.style.color = '#495057';
            });
            
            btnCalendario.addEventListener('mouseleave', function() {
                this.style.opacity = '0.7';
                this.style.backgroundColor = 'transparent';
                this.style.color = '#6c757d';
            });
            
            // Mostrar bot√£o quando o campo receber foco
            campo.addEventListener('focus', function() {
                btnCalendario.style.opacity = '1';
            });
            
            // Ocultar bot√£o quando o campo perder foco (se n√£o estiver sendo usado)
            campo.addEventListener('blur', function() {
                setTimeout(() => {
                    if (!btnCalendario.matches(':hover')) {
                        btnCalendario.style.opacity = '0.7';
                    }
                }, 200);
            });
        }

        // Fun√ß√£o para converter data brasileira (dd/mm/aaaa) para ISO (aaaa-mm-dd)
        function converterDataBrasileiraParaISO(dataBrasileira) {
            // Verificar formato dd/mm/aaaa
            const regex = /^(\d{2})\/(\d{2})\/(\d{4})$/;
            const match = dataBrasileira.match(regex);
            
            if (!match) return null;
            
            const dia = parseInt(match[1]);
            const mes = parseInt(match[2]);
            const ano = parseInt(match[3]);
            
            // Validar valores
            if (dia < 1 || dia > 31) return null;
            if (mes < 1 || mes > 12) return null;
            if (ano < 1900 || ano > 2100) return null;
            
            // Verificar se a data √© v√°lida
            const data = new Date(ano, mes - 1, dia);
            if (data.getDate() !== dia || data.getMonth() !== mes - 1 || data.getFullYear() !== ano) {
                return null;
            }
            
            // Retornar no formato ISO
            return data.toISOString().split('T')[0];
        }

        // Fun√ß√£o para limpar campos do formul√°rio
        function limparCamposFormulario() {
            const camposData = ['data_nascimento', 'validade_credencial'];
            camposData.forEach(campoId => {
                const campo = document.getElementById(campoId);
                if (campo) {
                    campo.value = '';
                    campo.type = 'text';
                }
            });
            
            // Tamb√©m limpar campos do modal
            const camposModal = ['modal_data_nascimento', 'modal_validade_credencial'];
            camposModal.forEach(campoId => {
                const campo = document.getElementById(campoId);
                if (campo) {
                    campo.value = '';
                    campo.type = 'text';
                }
            });
        }

        // Fun√ß√£o para abrir modal
        function abrirModalInstrutor() {
            limparCamposFormulario();
            document.getElementById('modalInstrutor').style.display = 'block';
            adicionarLog('Modal de teste aberto', 'info');
            
            // Configurar campos do modal
            setTimeout(() => {
                const camposModal = ['modal_data_nascimento', 'modal_validade_credencial'];
                camposModal.forEach(campoId => {
                    const campo = document.getElementById(campoId);
                    if (campo) {
                        configurarCampoDataHibrido(campoId, campo);
                    }
                });
            }, 100);
        }

        // Fun√ß√£o para fechar modal
        function fecharModalInstrutor() {
            document.getElementById('modalInstrutor').style.display = 'none';
            adicionarLog('Modal de teste fechado', 'info');
        }

        // Fun√ß√£o para salvar instrutor (simula√ß√£o)
        function salvarInstrutor() {
            const dataNascimento = document.getElementById('modal_data_nascimento').value;
            const validadeCredencial = document.getElementById('modal_validade_credencial').value;
            
            if (!dataNascimento) {
                adicionarLog('‚ùå Data de nascimento √© obrigat√≥ria', 'error');
                return;
            }
            
            // Converter datas para ISO
            const dataNascimentoISO = converterDataBrasileiraParaISO(dataNascimento);
            const validadeCredencialISO = validadeCredencial ? converterDataBrasileiraParaISO(validadeCredencial) : null;
            
            if (!dataNascimentoISO) {
                adicionarLog('‚ùå Data de nascimento inv√°lida', 'error');
                return;
            }
            
            if (validadeCredencial && !validadeCredencialISO) {
                adicionarLog('‚ùå Validade da credencial inv√°lida', 'error');
                return;
            }
            
            adicionarLog('‚úÖ Dados validados com sucesso!', 'success');
            adicionarLog(`üìÖ Data de nascimento: ${dataNascimento} ‚Üí ${dataNascimentoISO}`, 'info');
            if (validadeCredencialISO) {
                adicionarLog(`üìÖ Validade credencial: ${validadeCredencial} ‚Üí ${validadeCredencialISO}`, 'info');
            }
            
            // Simular salvamento
            setTimeout(() => {
                adicionarLog('üíæ Instrutor salvo com sucesso!', 'success');
                fecharModalInstrutor();
            }, 1000);
        }

        // Fun√ß√£o para verificar implementa√ß√£o
        function verificarImplementacao() {
            const resultado = document.getElementById('verificacaoResultado');
            let html = '<h3>üîç Verifica√ß√£o da Implementa√ß√£o:</h3><ul>';
            
            // Verificar campos principais
            const camposPrincipais = ['data_nascimento', 'validade_credencial'];
            camposPrincipais.forEach(campoId => {
                const campo = document.getElementById(campoId);
                if (campo && campo.type === 'text') {
                    html += `<li>‚úÖ Campo ${campoId}: Configurado como texto</li>`;
                } else {
                    html += `<li>‚ùå Campo ${campoId}: N√£o configurado corretamente</li>`;
                }
            });
            
            // Verificar bot√µes de calend√°rio
            const wrappers = document.querySelectorAll('[style*="position: relative"]');
            if (wrappers.length >= 2) {
                html += '<li>‚úÖ Wrappers de posicionamento: Configurados</li>';
            } else {
                html += '<li>‚ùå Wrappers de posicionamento: N√£o configurados</li>';
            }
            
            // Verificar funcionalidade de m√°scara
            const campoTeste = document.getElementById('data_nascimento');
            if (campoTeste) {
                campoTeste.value = '12345678';
                campoTeste.dispatchEvent(new Event('input'));
                if (campoTeste.value === '12/34/5678') {
                    html += '<li>‚úÖ M√°scara de data: Funcionando</li>';
                } else {
                    html += '<li>‚ùå M√°scara de data: N√£o funcionando</li>';
                }
                campoTeste.value = '';
            }
            
            html += '</ul>';
            resultado.innerHTML = html;
        }

        // Fun√ß√£o para limpar log
        function limparLog() {
            document.getElementById('logContainer').innerHTML = '<div class="log-entry log-info">Log limpo.</div>';
        }

        // Inicializar quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', function() {
            adicionarLog('P√°gina carregada. Configurando campos de data...', 'info');
            configurarCamposData();
            adicionarLog('‚úÖ Campos de data configurados com sucesso!', 'success');
            adicionarLog('üí° Teste: Digite uma data ou clique no calend√°rio', 'info');
        });

        // Fechar modal ao clicar fora
        window.onclick = function(event) {
            const modal = document.getElementById('modalInstrutor');
            if (event.target === modal) {
                fecharModalInstrutor();
            }
        }
    </script>
</body>
</html>

