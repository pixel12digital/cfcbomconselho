<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ Teste Modal Instrutor - Corre√ß√£o JavaScript</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .warning { background-color: #fff3cd; border-color: #ffeaa7; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .btn {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover { background: #0056b3; }
        .btn-success { background: #28a745; }
        .btn-success:hover { background: #1e7e34; }
        .btn-danger { background: #dc3545; }
        .btn-danger:hover { background: #c82333; }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 8px;
            width: 80%;
            max-width: 600px;
            position: relative;
        }
        .close {
            position: absolute;
            right: 20px;
            top: 15px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .form-group {
            margin: 15px 0;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Teste Modal Instrutor - Corre√ß√£o JavaScript</h1>
        <p><strong>Data/Hora:</strong> <span id="currentTime"></span></p>
        
        <div class="test-section success">
            <h3>‚úÖ Problema Identificado e Corrigido</h3>
            <p><strong>Erro JavaScript:</strong> <code>campoDataNascimento is not defined</code></p>
            <p><strong>Causa:</strong> Vari√°veis declaradas no escopo incorreto</p>
            <p><strong>Solu√ß√£o:</strong> Declarar vari√°veis dentro do setTimeout</p>
        </div>
        
        <div class="test-section warning">
            <h3>‚ö†Ô∏è Teste do Modal</h3>
            <p>Clique nos bot√µes abaixo para testar o comportamento do modal:</p>
            <button class="btn" onclick="abrirModal('novo')">üìù Novo Instrutor</button>
            <button class="btn" onclick="abrirModal('editar')">‚úèÔ∏è Editar Instrutor</button>
            <button class="btn btn-danger" onclick="fecharModal()">‚ùå Fechar Modal</button>
        </div>
        
        <div class="test-section">
            <h3>üîç Log de Eventos</h3>
            <div id="eventLog" class="log"></div>
            <button class="btn btn-success" onclick="limparLog()">üßπ Limpar Log</button>
        </div>
        
        <div class="test-section">
            <h3>üìã Status do Modal</h3>
            <p><strong>Modal Aberto:</strong> <span id="modalStatus">N√ÉO</span></p>
            <p><strong>√öltima A√ß√£o:</strong> <span id="lastAction">Nenhuma</span></p>
        </div>
    </div>
    
    <!-- Modal de Teste -->
    <div id="testModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="fecharModal()">&times;</span>
            <h2 id="modalTitle">Modal de Teste</h2>
            
            <form id="testForm">
                <div class="form-group">
                    <label for="nome">Nome:</label>
                    <input type="text" id="nome" name="nome" placeholder="Digite o nome">
                </div>
                
                <div class="form-group">
                    <label for="data_nascimento">Data de Nascimento:</label>
                    <input type="text" id="data_nascimento" name="data_nascimento" placeholder="dd/mm/aaaa">
                </div>
                
                <div class="form-group">
                    <label for="validade_credencial">Validade da Credencial:</label>
                    <input type="text" id="validade_credencial" name="validade_credencial" placeholder="dd/mm/aaaa">
                </div>
                
                <div class="form-group">
                    <label for="email">E-mail:</label>
                    <input type="email" id="email" name="email" placeholder="Digite o e-mail">
                </div>
                
                <div class="form-group">
                    <button type="button" class="btn btn-success" onclick="salvarFormulario()">üíæ Salvar</button>
                    <button type="button" class="btn btn-danger" onclick="fecharModal()">‚ùå Cancelar</button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        // Simular as fun√ß√µes corrigidas do instrutores-page.js
        let modalAberto = false;
        let ultimaAcao = 'Nenhuma';
        
        // Fun√ß√£o para abrir modal
        function abrirModal(tipo) {
            const modal = document.getElementById('testModal');
            const title = document.getElementById('modalTitle');
            
            if (tipo === 'novo') {
                title.textContent = 'Novo Instrutor';
                limparFormulario();
                logEvent('Modal aberto para NOVO instrutor');
            } else if (tipo === 'editar') {
                title.textContent = 'Editar Instrutor';
                preencherFormularioTeste();
                logEvent('Modal aberto para EDITAR instrutor');
            }
            
            modal.style.display = 'block';
            modalAberto = true;
            ultimaAcao = `Modal aberto: ${tipo}`;
            atualizarStatus();
            
            logEvent('Modal aberto com sucesso');
        }
        
        // Fun√ß√£o para fechar modal
        function fecharModal() {
            const modal = document.getElementById('testModal');
            modal.style.display = 'none';
            modalAberto = false;
            ultimaAcao = 'Modal fechado';
            atualizarStatus();
            
            logEvent('Modal fechado');
        }
        
        // Fun√ß√£o para limpar formul√°rio (SIMULANDO A CORRE√á√ÉO)
        function limparFormulario() {
            logEvent('Iniciando limpeza do formul√°rio...');
            
            // Campos de texto
            const camposTexto = ['nome', 'email'];
            camposTexto.forEach(campo => {
                const elemento = document.getElementById(campo);
                if (elemento) {
                    elemento.value = '';
                    logEvent(`Campo ${campo} limpo`);
                }
            });
            
            // Campos de data - CORRE√á√ÉO APLICADA AQUI!
            const camposData = ['data_nascimento', 'validade_credencial'];
            camposData.forEach(campoId => {
                const campo = document.getElementById(campoId);
                if (campo) {
                    campo.value = '';
                    campo.type = 'text';
                    logEvent(`Campo de data ${campoId} limpo e configurado`);
                }
            });
            
            // Testar a corre√ß√£o do setTimeout
            setTimeout(() => {
                // ‚úÖ CORRE√á√ÉO: Declarar vari√°veis dentro do setTimeout
                const campoDataNascimento = document.getElementById('data_nascimento');
                const campoValidadeCredencial = document.getElementById('validade_credencial');
                
                if (campoDataNascimento) {
                    campoDataNascimento.focus();
                    campoDataNascimento.blur();
                    logEvent('‚úÖ Campo data_nascimento configurado com sucesso (CORRE√á√ÉO APLICADA)');
                }
                
                if (campoValidadeCredencial) {
                    campoValidadeCredencial.focus();
                    campoValidadeCredencial.blur();
                    logEvent('‚úÖ Campo validade_credencial configurado com sucesso (CORRE√á√ÉO APLICADA)');
                }
            }, 100);
            
            logEvent('Formul√°rio limpo com sucesso');
        }
        
        // Fun√ß√£o para preencher formul√°rio de teste
        function preencherFormularioTeste() {
            document.getElementById('nome').value = 'Instrutor Teste';
            document.getElementById('data_nascimento').value = '15/03/1985';
            document.getElementById('validade_credencial').value = '15/03/2025';
            document.getElementById('email').value = 'teste@cfc.com';
            
            logEvent('Formul√°rio preenchido com dados de teste');
        }
        
        // Fun√ß√£o para salvar formul√°rio
        function salvarFormulario() {
            logEvent('Tentando salvar formul√°rio...');
            
            // Simular salvamento
            setTimeout(() => {
                logEvent('‚úÖ Formul√°rio salvo com sucesso!');
                mostrarAlerta('Formul√°rio salvo com sucesso!', 'success');
                
                // Fechar modal ap√≥s salvar
                setTimeout(() => {
                    fecharModal();
                }, 1000);
            }, 500);
        }
        
        // Fun√ß√£o para mostrar alerta
        function mostrarAlerta(mensagem, tipo) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${tipo}`;
            alertDiv.style.cssText = 'position: fixed; top: 20px; right: 20px; z-index: 10000; padding: 15px; border-radius: 5px; color: white;';
            
            if (tipo === 'success') {
                alertDiv.style.backgroundColor = '#28a745';
            } else if (tipo === 'danger') {
                alertDiv.style.backgroundColor = '#dc3545';
            }
            
            alertDiv.textContent = mensagem;
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 3000);
        }
        
        // Fun√ß√£o para log de eventos
        function logEvent(mensagem) {
            const log = document.getElementById('eventLog');
            const timestamp = new Date().toLocaleTimeString();
            log.innerHTML += `[${timestamp}] ${mensagem}\n`;
            log.scrollTop = log.scrollHeight;
        }
        
        // Fun√ß√£o para limpar log
        function limparLog() {
            document.getElementById('eventLog').innerHTML = '';
        }
        
        // Fun√ß√£o para atualizar status
        function atualizarStatus() {
            document.getElementById('modalStatus').textContent = modalAberto ? 'SIM' : 'N√ÉO';
            document.getElementById('lastAction').textContent = ultimaAcao;
        }
        
        // Fechar modal ao clicar fora
        window.onclick = function(event) {
            const modal = document.getElementById('testModal');
            if (event.target === modal) {
                fecharModal();
            }
        }
        
        // Fechar modal com tecla ESC
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && modalAberto) {
                fecharModal();
            }
        });
        
        // Atualizar hora atual
        function atualizarHora() {
            document.getElementById('currentTime').textContent = new Date().toLocaleString('pt-BR');
        }
        
        // Inicializar
        setInterval(atualizarHora, 1000);
        atualizarHora();
        
        logEvent('üß™ Sistema de teste inicializado');
        logEvent('‚úÖ Corre√ß√£o JavaScript aplicada: campoDataNascimento e campoValidadeCredencial declarados corretamente');
    </script>
</body>
</html>
