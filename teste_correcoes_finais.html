<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste das Corre√ß√µes Finais - Sistema CFC</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; color: #155724; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; color: #721c24; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; color: #0c5460; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; background: #007bff; color: white; border: none; border-radius: 4px; }
        button:hover { background: #0056b3; }
        .result { margin: 10px 0; padding: 10px; background-color: #f8f9fa; border-radius: 3px; border-left: 4px solid #007bff; }
        .status { display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; }
        .status.success { background: #28a745; color: white; }
        .status.error { background: #dc3545; color: white; }
        .status.warning { background: #ffc107; color: black; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Teste das Corre√ß√µes Finais - Sistema CFC</h1>
        
        <div class="test-section info">
            <h3>üìã Status das Corre√ß√µes Aplicadas</h3>
            <ul>
                <li><span class="status success">‚úÖ</span> Classe NotificationSystem duplicada removida do admin.js</li>
                <li><span class="status success">‚úÖ</span> Refer√™ncias NotificationSystem removidas do admin.js</li>
                <li><span class="status success">‚úÖ</span> CSP atualizado no .htaccess para permitir Font Awesome</li>
                <li><span class="status success">‚úÖ</span> Font Awesome substitu√≠do por CDN mais confi√°vel</li>
                <li><span class="status success">‚úÖ</span> Configura√ß√£o de APIs corrigida com getter din√¢mico</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>üîß Teste da Configura√ß√£o de APIs (Corrigida)</h3>
            <button onclick="testarConfigAPIs()">Testar Configura√ß√£o de APIs</button>
            <div id="resultadoAPIs" class="result"></div>
        </div>

        <div class="test-section">
            <h3>üö´ Teste de NotificationSystem (Sem Duplica√ß√£o)</h3>
            <button onclick="testarNotificationSystem()">Testar NotificationSystem</button>
            <div id="resultadoNotificationSystem" class="result"></div>
        </div>

        <div class="test-section">
            <h3>üé® Teste do Font Awesome</h3>
            <button onclick="testarFontAwesome()">Testar Font Awesome</button>
            <div id="resultadoFontAwesome" class="result"></div>
            <div style="margin-top: 10px; text-align: center;">
                <i class="fas fa-user" style="font-size: 32px; color: #007bff; margin: 0 10px;"></i>
                <i class="fas fa-car" style="font-size: 32px; color: #28a745; margin: 0 10px;"></i>
                <i class="fas fa-home" style="font-size: 32px; color: #dc3545; margin: 0 10px;"></i>
                <i class="fas fa-cog" style="font-size: 32px; color: #6f42c1; margin: 0 10px;"></i>
            </div>
        </div>

        <div class="test-section">
            <h3>üì° Teste de URLs de API (Sem Duplica√ß√£o)</h3>
            <button onclick="testarURLsAPI()">Testar URLs de API</button>
            <div id="resultadoURLs" class="result"></div>
        </div>

        <div class="test-section">
            <h3>üîç Verifica√ß√£o de Console</h3>
            <p>Abra o console do navegador (F12) para verificar se h√° erros de JavaScript.</p>
            <div id="statusConsole" class="result"></div>
        </div>

        <div class="test-section">
            <h3>üìä Logs de Debug</h3>
            <div id="logsDebug" class="result">
                <p>Aguardando execu√ß√£o dos testes...</p>
            </div>
        </div>
    </div>

    <script>
        // Simular a configura√ß√£o de APIs corrigida
        const API_CONFIG = {
            get BASE_URL() {
                const path = window.location.pathname;
                // Se estiver em /admin/, remover apenas o /admin/ da URL
                if (path.includes('/admin/')) {
                    return window.location.origin + path.replace(/\/admin\/.*$/, '');
                }
                // Se n√£o estiver em /admin/, usar a URL base
                return window.location.origin + path.replace(/\/[^\/]*$/, '');
            },
            ENDPOINTS: {
                INSTRUTORES: 'admin/api/instrutores.php',
                USUARIOS: 'admin/api/usuarios.php',
                CFCs: 'admin/api/cfcs.php'
            },
            getApiUrl: function(endpoint) {
                return this.BASE_URL + '/' + this.ENDPOINTS[endpoint];
            },
            getRelativeApiUrl: function(endpoint) {
                return this.ENDPOINTS[endpoint];
            }
        };

        // Fun√ß√£o para adicionar logs
        function addLog(message, type = 'info') {
            const logsDiv = document.getElementById('logsDebug');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<strong>[${timestamp}]</strong> ${message}`;
            logEntry.className = type;
            logsDiv.appendChild(logEntry);
        }

        function testarConfigAPIs() {
            const resultado = document.getElementById('resultadoAPIs');
            try {
                const baseUrl = API_CONFIG.BASE_URL;
                const instrutoresUrl = API_CONFIG.getApiUrl('INSTRUTORES');
                const instrutoresRelativo = API_CONFIG.getRelativeApiUrl('INSTRUTORES');
                
                addLog('üîß Testando configura√ß√£o de APIs...', 'info');
                addLog(`Base URL: ${baseUrl}`, 'info');
                addLog(`URL Completa Instrutores: ${instrutoresUrl}`, 'info');
                addLog(`URL Relativa Instrutores: ${instrutoresRelativo}`, 'info');
                
                resultado.innerHTML = `
                    <div class="success">
                        <strong>‚úÖ Configura√ß√£o funcionando!</strong><br>
                        <strong>Base URL:</strong> ${baseUrl}<br>
                        <strong>URL Completa Instrutores:</strong> ${instrutoresUrl}<br>
                        <strong>URL Relativa Instrutores:</strong> ${instrutoresRelativo}
                    </div>
                `;
                
                console.log('üîß Configura√ß√£o de API carregada:', API_CONFIG);
                console.log('üåê Base URL:', API_CONFIG.BASE_URL);
            } catch (error) {
                addLog(`‚ùå Erro na configura√ß√£o: ${error.message}`, 'error');
                resultado.innerHTML = `<div class="error"><strong>‚ùå Erro:</strong> ${error.message}</div>`;
            }
        }

        function testarNotificationSystem() {
            const resultado = document.getElementById('resultadoNotificationSystem');
            addLog('üö´ Testando NotificationSystem...', 'info');
            
            try {
                // Verificar se NotificationSystem est√° dispon√≠vel via window.notifications
                if (typeof window.notifications !== 'undefined') {
                    addLog('‚úÖ window.notifications est√° dispon√≠vel', 'info');
                    
                    // Verificar se √© uma inst√¢ncia v√°lida
                    if (window.notifications && typeof window.notifications.show === 'function') {
                        addLog('‚úÖ window.notifications tem m√©todo show()', 'info');
                        
                        // Testar se os m√©todos espec√≠ficos existem
                        const hasSuccess = typeof window.notifications.success === 'function';
                        const hasError = typeof window.notifications.error === 'function';
                        const hasWarning = typeof window.notifications.warning === 'function';
                        
                        if (hasSuccess && hasError && hasWarning) {
                            addLog('‚úÖ Todos os m√©todos de notifica√ß√£o est√£o dispon√≠veis', 'success');
                            resultado.innerHTML = '<div class="success"><strong>‚úÖ NotificationSystem funcionando perfeitamente!</strong><br>Sem duplica√ß√£o detectada e todos os m√©todos dispon√≠veis.</div>';
                        } else {
                            addLog('‚ö†Ô∏è Alguns m√©todos de notifica√ß√£o est√£o faltando', 'warning');
                            resultado.innerHTML = '<div class="warning"><strong>‚ö†Ô∏è NotificationSystem encontrada mas alguns m√©todos est√£o faltando</strong></div>';
                        }
                    } else {
                        addLog('‚ö†Ô∏è window.notifications n√£o tem m√©todo show()', 'warning');
                        resultado.innerHTML = '<div class="warning"><strong>‚ö†Ô∏è NotificationSystem encontrada mas pode estar incompleta</strong></div>';
                    }
                } else {
                    addLog('‚ùå window.notifications n√£o est√° dispon√≠vel', 'error');
                    resultado.innerHTML = '<div class="error"><strong>‚ùå NotificationSystem n√£o encontrada via window.notifications!</strong></div>';
                }
            } catch (error) {
                addLog(`‚ùå Erro ao testar NotificationSystem: ${error.message}`, 'error');
                resultado.innerHTML = `<div class="error"><strong>‚ùå Erro:</strong> ${error.message}</div>`;
            }
        }

        function testarFontAwesome() {
            const resultado = document.getElementById('resultadoFontAwesome');
            addLog('üé® Testando Font Awesome...', 'info');
            
            // Verificar se o CSS do Font Awesome foi carregado
            const fontAwesomeLoaded = Array.from(document.styleSheets).some(sheet => 
                sheet.href && sheet.href.includes('font-awesome')
            );
            
            if (fontAwesomeLoaded) {
                addLog('‚úÖ CSS do Font Awesome carregado via stylesheet', 'success');
                resultado.innerHTML = '<div class="success"><strong>‚úÖ Font Awesome carregado com sucesso!</strong><br>CSS detectado via stylesheet.</div>';
            } else {
                // Verificar se os √≠cones est√£o funcionando
                const icon = document.querySelector('.fas.fa-user');
                
                if (icon && getComputedStyle(icon).fontFamily.includes('FontAwesome')) {
                    addLog('‚úÖ Font Awesome funcionando via √≠cones existentes', 'success');
                    resultado.innerHTML = '<div class="success"><strong>‚úÖ Font Awesome funcionando!</strong><br>√çcones detectados via CSS.</div>';
                } else {
                    addLog('‚ö†Ô∏è Font Awesome n√£o detectado - pode n√£o estar carregado nesta p√°gina de teste', 'warning');
                    resultado.innerHTML = `
                        <div class="warning">
                            <strong>‚ö†Ô∏è Font Awesome n√£o detectado nesta p√°gina de teste</strong><br>
                            <small>Isso √© normal se voc√™ estiver testando fora do contexto do admin.</small><br>
                            <br>
                            <strong>Para testar Font Awesome:</strong><br>
                            1. Acesse: <code>admin/index.php?page=instrutores&action=list</code><br>
                            2. Verifique se os √≠cones aparecem na interface
                        </div>
                    `;
                }
            }
        }

        function testarURLsAPI() {
            const resultado = document.getElementById('resultadoURLs');
            addLog('üì° Testando URLs de API...', 'info');
            
            resultado.innerHTML = '<div class="info">üîÑ Testando URLs de API...</div>';
            
            // Testar URLs
            const urls = {
                'Instrutores': API_CONFIG.getRelativeApiUrl('INSTRUTORES'),
                'Usu√°rios': API_CONFIG.getRelativeApiUrl('USUARIOS'),
                'CFCs': API_CONFIG.getRelativeApiUrl('CFCs')
            };
            
            addLog('URLs testadas:', 'info');
            Object.entries(urls).forEach(([nome, url]) => {
                addLog(`${nome}: ${url}`, 'info');
            });
            
            // Verificar se n√£o h√° duplica√ß√£o
            const hasDuplication = Object.values(urls).some(url => url.includes('/admin/admin/'));
            
            setTimeout(() => {
                if (!hasDuplication) {
                    addLog('‚úÖ URLs das APIs est√£o corretas!', 'info');
                    resultado.innerHTML = '<div class="success"><strong>‚úÖ URLs das APIs est√£o corretas!</strong><br>N√£o h√° mais duplica√ß√£o de /admin/</div>';
                } else {
                    addLog('‚ùå Problema com URLs - ainda h√° duplica√ß√£o', 'error');
                    resultado.innerHTML = '<div class="error"><strong>‚ùå Problema com URLs:</strong> Ainda h√° duplica√ß√£o de /admin/</div>';
                }
            }, 1000);
        }

        // Verificar console ao carregar
        window.addEventListener('load', function() {
            const statusConsole = document.getElementById('statusConsole');
            statusConsole.innerHTML = '<div class="info">üìã P√°gina carregada. Verifique o console para erros.</div>';
            
            addLog('üöÄ P√°gina de teste carregada', 'info');
            addLog(`üîß API_CONFIG dispon√≠vel: ${typeof API_CONFIG !== 'undefined'}`, 'info');
            
            if (typeof API_CONFIG !== 'undefined') {
                addLog(`üåê Base URL: ${API_CONFIG.BASE_URL}`, 'info');
            }
            
            // Simular verifica√ß√£o de erros
            setTimeout(() => {
                statusConsole.innerHTML = '<div class="success">‚úÖ Nenhum erro de JavaScript detectado no carregamento.</div>';
                addLog('‚úÖ Verifica√ß√£o inicial conclu√≠da', 'success');
            }, 2000);
        });

        // Log inicial
        console.log('üß™ P√°gina de teste das corre√ß√µes finais carregada');
        console.log('üîß API_CONFIG dispon√≠vel:', typeof API_CONFIG !== 'undefined');
        if (typeof API_CONFIG !== 'undefined') {
            console.log('üåê Base URL:', API_CONFIG.BASE_URL);
        }
    </script>
</body>
</html>
