<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste das APIs - Instrutores</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background-color: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background-color: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .info { background-color: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="mb-4">
            <i class="fas fa-vial text-primary"></i>
            Teste das APIs - Sistema de Instrutores
        </h1>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-users text-info"></i> Teste API Usuários</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-primary mb-3" onclick="testarAPIUsuarios()">
                            <i class="fas fa-play"></i> Testar API Usuários
                        </button>
                        <div id="resultadoUsuarios"></div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-building text-success"></i> Teste API CFCs</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-success mb-3" onclick="testarAPICFCs()">
                            <i class="fas fa-play"></i> Testar API CFCs
                        </button>
                        <div id="resultadoCFCs"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-cogs text-warning"></i> Teste Completo</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-warning mb-3" onclick="testarTodasAPIs()">
                            <i class="fas fa-rocket"></i> Testar Todas as APIs
                        </button>
                        <div id="resultadoCompleto"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function mostrarResultado(elementId, mensagem, tipo) {
            const elemento = document.getElementById(elementId);
            elemento.innerHTML = `<div class="test-result ${tipo}">${mensagem}</div>`;
        }

        async function testarAPIUsuarios() {
            mostrarResultado('resultadoUsuarios', '<i class="fas fa-spinner fa-spin"></i> Testando...', 'info');
            
            try {
                const response = await fetch('admin/api/usuarios.php');
                const data = await response.json();
                
                if (data.success) {
                    const usuarios = data.data;
                    const html = `
                        <div class="test-result success">
                            <i class="fas fa-check-circle"></i> <strong>API Usuários funcionando!</strong><br>
                            <small>Total de usuários: ${usuarios.length}</small>
                            ${usuarios.length > 0 ? '<br><small>Primeiro usuário: ' + usuarios[0].nome + '</small>' : ''}
                        </div>
                    `;
                    mostrarResultado('resultadoUsuarios', html, '');
                } else {
                    mostrarResultado('resultadoUsuarios', `<i class="fas fa-exclamation-triangle"></i> <strong>Erro na API:</strong> ${data.error}`, 'error');
                }
            } catch (error) {
                mostrarResultado('resultadoUsuarios', `<i class="fas fa-times-circle"></i> <strong>Erro de conexão:</strong> ${error.message}`, 'error');
            }
        }

        async function testarAPICFCs() {
            mostrarResultado('resultadoCFCs', '<i class="fas fa-spinner fa-spin"></i> Testando...', 'info');
            
            try {
                const response = await fetch('admin/api/cfcs.php');
                const data = await response.json();
                
                if (data.success) {
                    const cfcs = data.data;
                    const html = `
                        <div class="test-result success">
                            <i class="fas fa-check-circle"></i> <strong>API CFCs funcionando!</strong><br>
                            <small>Total de CFCs: ${cfcs.length}</small>
                            ${cfcs.length > 0 ? '<br><small>Primeiro CFC: ' + cfcs[0].nome + '</small>' : ''}
                        </div>
                    `;
                    mostrarResultado('resultadoCFCs', html, '');
                } else {
                    mostrarResultado('resultadoCFCs', `<i class="fas fa-exclamation-triangle"></i> <strong>Erro na API:</strong> ${data.error}`, 'error');
                }
            } catch (error) {
                mostrarResultado('resultadoCFCs', `<i class="fas fa-times-circle"></i> <strong>Erro de conexão:</strong> ${error.message}`, 'error');
            }
        }

        async function testarTodasAPIs() {
            mostrarResultado('resultadoCompleto', '<i class="fas fa-spinner fa-spin"></i> Testando todas as APIs...', 'info');
            
            let resultados = [];
            
            // Testar API Usuários
            try {
                const responseUsuarios = await fetch('admin/api/usuarios.php');
                const dataUsuarios = await responseUsuarios.json();
                if (dataUsuarios.success) {
                    resultados.push(`✅ Usuários: ${dataUsuarios.data.length} encontrados`);
                } else {
                    resultados.push(`❌ Usuários: ${dataUsuarios.error}`);
                }
            } catch (error) {
                resultados.push(`❌ Usuários: Erro de conexão`);
            }
            
            // Testar API CFCs
            try {
                const responseCFCs = await fetch('admin/api/cfcs.php');
                const dataCFCs = await responseCFCs.json();
                if (dataCFCs.success) {
                    resultados.push(`✅ CFCs: ${dataCFCs.data.length} encontrados`);
                } else {
                    resultados.push(`❌ CFCs: ${dataCFCs.error}`);
                }
            } catch (error) {
                resultados.push(`❌ CFCs: Erro de conexão`);
            }
            
            // Testar API Instrutores
            try {
                const responseInstrutores = await fetch('admin/api/instrutores.php');
                const dataInstrutores = await responseInstrutores.json();
                if (dataInstrutores.success) {
                    resultados.push(`✅ Instrutores: ${dataInstrutores.data ? dataInstrutores.data.length : 0} encontrados`);
                } else {
                    resultados.push(`❌ Instrutores: ${dataInstrutores.error}`);
                }
            } catch (error) {
                resultados.push(`❌ Instrutores: Erro de conexão`);
            }
            
            const html = `
                <div class="test-result info">
                    <i class="fas fa-clipboard-list"></i> <strong>Resultado dos Testes:</strong><br>
                    ${resultados.join('<br>')}
                </div>
            `;
            mostrarResultado('resultadoCompleto', html, '');
        }

        // Testar automaticamente ao carregar a página
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                testarTodasAPIs();
            }, 1000);
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
