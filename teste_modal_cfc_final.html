<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Final - Modal CFC</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        /* CSS específico para CFCs - Versão Otimizada */
        #modalCFC .modal-dialog {
            max-width: 1000px !important;
            width: 1000px !important;
            margin: 2rem auto !important;
            position: relative !important;
            left: auto !important;
            right: auto !important;
            transform: none !important;
        }

        /* Responsividade otimizada */
        @media (max-width: 1200px) {
            #modalCFC .modal-dialog {
                max-width: 90vw !important;
                width: 90vw !important;
                margin: 1rem auto !important;
            }
        }

        @media (max-width: 768px) {
            #modalCFC .modal-dialog {
                max-width: 95vw !important;
                width: 95vw !important;
                margin: 0.5rem auto !important;
            }
        }

        @media (max-width: 576px) {
            #modalCFC .modal-dialog {
                max-width: 98vw !important;
                width: 98vw !important;
                margin: 0.25rem auto !important;
            }
        }

        /* Garantir que o modal não seja cortado */
        #modalCFC {
            overflow: visible !important;
            z-index: 1055 !important;
        }

        #modalCFC .modal-dialog {
            overflow: visible !important;
            z-index: 1056 !important;
        }

        #modalCFC .modal-content {
            overflow: visible !important;
            z-index: 1057 !important;
        }

        /* CRÍTICO: Forçar estrutura flexbox para o modal-content */
        #modalCFC .modal-content {
            display: flex !important;
            flex-direction: column !important;
            height: auto !important;
            min-height: 0 !important;
            /* Garantir que o conteúdo seja renderizado corretamente */
            position: relative !important;
            overflow: hidden !important;
        }

        /* CRÍTICO: Garantir que o header tenha altura fixa */
        #modalCFC .modal-header {
            flex-shrink: 0 !important;
            position: relative !important;
            z-index: 3 !important;
        }

        /* CRÍTICO: Garantir que o body seja flexível */
        #modalCFC .modal-body {
            flex: 1 1 auto !important;
            overflow-y: auto !important;
            max-height: 70vh !important;
            position: relative !important;
            z-index: 1 !important;
        }

        /* CRÍTICO: Garantir que o footer fique no final */
        #modalCFC .modal-footer {
            flex-shrink: 0 !important;
            position: relative !important;
            z-index: 3 !important;
            margin-top: auto !important;
            border-top: 1px solid #dee2e6 !important;
            background-color: #f8f9fa !important;
            padding: 1rem !important;
            width: 100% !important;
            box-sizing: border-box !important;
            /* Garantir que o footer não escape do modal */
            bottom: 0 !important;
            left: 0 !important;
            right: 0 !important;
        }

        /* CRÍTICO: Sobrescrever qualquer CSS do Bootstrap que possa estar causando o problema */
        #modalCFC .modal-content,
        #modalCFC .modal-content * {
            box-sizing: border-box !important;
        }

        /* CRÍTICO: Forçar que o footer seja renderizado dentro do modal-content */
        #modalCFC .modal-content .modal-footer {
            position: relative !important;
            float: none !important;
            clear: both !important;
            display: block !important;
            width: 100% !important;
            margin: 0 !important;
            padding: 1rem !important;
            border-top: 1px solid #dee2e6 !important;
            background-color: #f8f9fa !important;
        }

        /* CRÍTICO: Garantir que o modal-dialog tenha altura adequada */
        #modalCFC .modal-dialog {
            height: auto !important;
            min-height: 0 !important;
            display: flex !important;
            flex-direction: column !important;
        }

        /* CRÍTICO: Garantir que o modal-content ocupe toda a altura disponível */
        #modalCFC .modal-dialog .modal-content {
            height: auto !important;
            min-height: 0 !important;
            display: flex !important;
            flex-direction: column !important;
        }

        /* Sobrescrever Bootstrap completamente */
        .modal-dialog.modal-custom-cfc {
            max-width: 1000px !important;
            width: 1000px !important;
            margin: 2rem auto !important;
            position: relative !important;
            left: auto !important;
            right: auto !important;
            transform: none !important;
            top: auto !important;
            bottom: auto !important;
        }

        /* Forçar largura em todos os contextos */
        .modal .modal-dialog.modal-custom-cfc,
        .modal.show .modal-dialog.modal-custom-cfc,
        .modal.fade .modal-dialog.modal-custom-cfc {
            max-width: 1000px !important;
            width: 1000px !important;
            margin: 2rem auto !important;
            position: relative !important;
            left: auto !important;
            right: auto !important;
            transform: none !important;
        }

        /* Responsividade para modal customizado */
        @media (max-width: 1400px) {
            .modal-dialog.modal-custom-cfc {
                max-width: 95vw !important;
                width: 95vw !important;
                margin: 1rem auto !important;
            }
        }

        @media (max-width: 1200px) {
            .modal-dialog.modal-custom-cfc {
                max-width: 90vw !important;
                width: 90vw !important;
                margin: 1rem auto !important;
            }
        }

        @media (max-width: 768px) {
            .modal-dialog.modal-custom-cfc {
                max-width: 95vw !important;
                width: 95vw !important;
                margin: 0.5rem auto !important;
            }
        }

        @media (max-width: 576px) {
            .modal-dialog.modal-custom-cfc {
                max-width: 98vw !important;
                width: 98vw !important;
                margin: 0.25rem auto !important;
            }
        }

        /* CRÍTICO: Garantir que o modal seja exibido corretamente em todos os navegadores */
        .modal.show .modal-dialog {
            transform: none !important;
        }

        .modal.fade .modal-dialog {
            transition: none !important;
        }

        /* Garantir que o backdrop não interfira */
        .modal-backdrop {
            z-index: 1054 !important;
        }

        /* CRÍTICO: Forçar estrutura correta do modal */
        #modalCFC .modal-content > * {
            position: relative !important;
            z-index: 1 !important;
        }

        /* Garantir que os botões do footer sejam visíveis */
        #modalCFC .modal-footer .btn {
            position: relative !important;
            z-index: 2 !important;
        }

        /* Estilos para teste */
        body {
            background-color: #f8f9fa;
            padding: 20px;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        
        .test-button {
            margin: 10px;
            padding: 15px 30px;
            font-size: 16px;
            border-radius: 8px;
        }
        
        .status-indicator {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        
        .status-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 class="text-center mb-4">
            <i class="fas fa-check-circle text-success me-2"></i>
            Teste Final - Modal CFC
        </h1>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-cog me-2"></i>Controles de Teste</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-primary test-button" onclick="abrirModalCFC('criar')">
                            <i class="fas fa-plus me-2"></i>Abrir Modal CFC
                        </button>
                        
                        <button class="btn btn-success test-button" onclick="verificarEstrutura()">
                            <i class="fas fa-search me-2"></i>Verificar Estrutura
                        </button>
                        
                        <button class="btn btn-info test-button" onclick="verificarCSS()">
                            <i class="fas fa-paint-brush me-2"></i>Verificar CSS
                        </button>
                        
                        <button class="btn btn-warning test-button" onclick="testarResponsividade()">
                            <i class="fas fa-mobile-alt me-2"></i>Testar Responsividade
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-info-circle me-2"></i>Status do Teste</h5>
                    </div>
                    <div class="card-body">
                        <div id="statusContainer">
                            <div class="status-indicator status-success">
                                ✅ Modal carregado e pronto para teste
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-list me-2"></i>Log de Testes</h5>
                    </div>
                    <div class="card-body">
                        <div id="logContainer" style="max-height: 300px; overflow-y: auto; background: #f8f9fa; padding: 15px; border-radius: 5px; font-family: monospace;">
                            <div class="text-muted">Log de testes aparecerá aqui...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Bootstrap para Cadastro/Edição de CFC -->
    <div class="modal fade" id="modalCFC" tabindex="-1" aria-labelledby="modalCFCLabel" aria-hidden="true">
        <div class="modal-dialog modal-custom-cfc">
            <div class="modal-content">
                <form id="formCFC" onsubmit="return false;">
                    <div class="modal-header">
                        <h5 class="modal-title" id="modalTitle">
                            <i class="fas fa-building me-2"></i>Novo CFC
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" name="acao" id="acaoCFC" value="criar">
                        <input type="hidden" name="cfc_id" id="cfc_id" value="">
                        
                        <div class="container-fluid">
                            <!-- Seção 1: Informações Básicas -->
                            <div class="row mb-2">
                                <div class="col-12">
                                    <h6 class="text-primary border-bottom pb-1 mb-2">
                                        <i class="fas fa-building me-1"></i>Informações Básicas
                                    </h6>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-1">
                                        <label for="nome" class="form-label">Nome do CFC *</label>
                                        <input type="text" class="form-control" id="nome" name="nome" required 
                                               placeholder="Nome completo do Centro de Formação de Condutores">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-1">
                                        <label for="cnpj" class="form-label">CNPJ *</label>
                                        <input type="text" class="form-control" id="cnpj" name="cnpj" required 
                                               placeholder="00.000.000/0000-00">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row mb-2">
                                <div class="col-md-12">
                                    <div class="mb-1">
                                        <label for="razao_social" class="form-label">Razão Social</label>
                                        <input type="text" class="form-control" id="razao_social" name="razao_social" 
                                               placeholder="Razão social da empresa (opcional)">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Seção 2: Contato -->
                            <div class="row mb-2">
                                <div class="col-12">
                                    <h6 class="text-primary border-bottom pb-1 mb-2">
                                        <i class="fas fa-phone me-1"></i>Contato
                                    </h6>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-1">
                                        <label for="email" class="form-label">E-mail</label>
                                        <input type="email" class="form-control" id="email" name="email" 
                                               placeholder="contato@cfc.com.br">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-1">
                                        <label for="telefone" class="form-label">Telefone</label>
                                        <input type="text" class="form-control" id="telefone" name="telefone" 
                                               placeholder="(00) 00000-0000">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Seção 3: Endereço -->
                            <div class="row mb-2">
                                <div class="col-12">
                                    <h6 class="text-primary border-bottom pb-1 mb-2">
                                        <i class="fas fa-map-marker-alt me-1"></i>Endereço
                                    </h6>
                                </div>
                                <div class="col-md-2">
                                    <div class="mb-1">
                                        <label for="cep" class="form-label">CEP</label>
                                        <input type="text" class="form-control" id="cep" name="cep" 
                                               placeholder="00000-000">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-1">
                                        <label for="endereco" class="form-control" id="endereco" name="endereco" 
                                               placeholder="Rua, Avenida, número, etc.">
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="mb-1">
                                        <label for="bairro" class="form-label">Bairro</label>
                                        <input type="text" class="form-control" id="bairro" name="bairro" 
                                               placeholder="Centro, Jardim, etc.">
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="mb-1">
                                        <label for="cidade" class="form-label">Cidade</label>
                                        <input type="text" class="form-control" id="cidade" name="cidade" 
                                               placeholder="Nome da cidade">
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="mb-1">
                                        <label for="uf" class="form-label">UF</label>
                                        <select class="form-select" id="uf" name="uf">
                                            <option value="">Selecione...</option>
                                            <option value="PE">Pernambuco</option>
                                            <option value="SP">São Paulo</option>
                                            <option value="RJ">Rio de Janeiro</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Seção 4: Configurações -->
                            <div class="row mb-2">
                                <div class="col-12">
                                    <h6 class="text-primary border-bottom pb-1 mb-2">
                                        <i class="fas fa-cog me-1"></i>Configurações
                                    </h6>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-1">
                                        <label for="responsavel_id" class="form-label">Responsável</label>
                                        <select class="form-select" id="responsavel_id" name="responsavel_id">
                                            <option value="">Selecione um usuário...</option>
                                            <option value="1">Administrador</option>
                                            <option value="2">Instrutor</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-1">
                                        <label for="ativo" class="form-label">Status</label>
                                        <select class="form-select" id="ativo" name="ativo">
                                            <option value="1">Ativo</option>
                                            <option value="0">Inativo</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Seção 5: Observações -->
                            <div class="row">
                                <div class="col-12">
                                    <h6 class="text-primary border-bottom pb-1 mb-2">
                                        <i class="fas fa-sticky-note me-1"></i>Observações
                                    </h6>
                                    <div class="mb-1">
                                        <label for="observacoes" class="form-label">Observações</label>
                                        <textarea class="form-control" id="observacoes" name="observacoes" rows="3" 
                                                  placeholder="Informações adicionais sobre o CFC..."></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            <i class="fas fa-times me-1"></i>Cancelar
                        </button>
                        <button type="submit" class="btn btn-primary" id="btnSalvarCFC">
                            <i class="fas fa-save me-1"></i>Salvar CFC
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Função para abrir modal de CFC
        function abrirModalCFC(modo = 'criar') {
            const modal = document.getElementById('modalCFC');
            if (!modal) {
                adicionarLog('❌ Modal não encontrado!', 'error');
                return;
            }
            
            // Limpar formulário apenas se for para criar novo CFC
            if (modo === 'criar') {
                const form = document.getElementById('formCFC');
                if (form) {
                    form.reset();
                    const acaoField = document.getElementById('acaoCFC');
                    const cfcIdField = document.getElementById('cfc_id');
                    const modalTitle = document.getElementById('modalTitle');
                    
                    if (acaoField) acaoField.value = 'criar';
                    if (cfcIdField) cfcIdField.value = '';
                    if (modalTitle) modalTitle.textContent = 'Novo CFC';
                }
            }
            
            // SOLUÇÃO CRÍTICA: Forçar estilos CSS antes de abrir o modal
            const modalDialog = modal.querySelector('.modal-dialog');
            if (modalDialog) {
                // Aplicar estilos inline para sobrescrever qualquer CSS
                modalDialog.style.setProperty('max-width', '1000px', 'important');
                modalDialog.style.setProperty('width', '1000px', 'important');
                modalDialog.style.setProperty('margin', '2rem auto', 'important');
                modalDialog.style.setProperty('position', 'relative', 'important');
                modalDialog.style.setProperty('z-index', '1056', 'important');
                
                // Aplicar estilos responsivos
                if (window.innerWidth <= 1200) {
                    modalDialog.style.setProperty('max-width', '90vw', 'important');
                    modalDialog.style.setProperty('width', '90vw', 'important');
                    modalDialog.style.setProperty('margin', '1rem auto', 'important');
                }
                if (window.innerWidth <= 768) {
                    modalDialog.style.setProperty('max-width', '95vw', 'important');
                    modalDialog.style.setProperty('width', '95vw', 'important');
                    modalDialog.style.setProperty('margin', '0.5rem auto', 'important');
                }
                if (window.innerWidth <= 576) {
                    modalDialog.style.setProperty('max-width', '98vw', 'important');
                    modalDialog.style.setProperty('width', '98vw', 'important');
                    modalDialog.style.setProperty('margin', '0.25rem auto', 'important');
                }
            }
            
            // Mostrar modal usando Bootstrap
            if (typeof bootstrap !== 'undefined' && bootstrap.Modal) {
                const bootstrapModal = new bootstrap.Modal(modal);
                bootstrapModal.show();
                
                // Aplicar estilos finais para garantir funcionamento
                setTimeout(() => {
                    if (modalDialog) {
                        modalDialog.style.setProperty('max-width', '1000px', 'important');
                        modalDialog.style.setProperty('width', '1000px', 'important');
                        modalDialog.style.setProperty('margin', '2rem auto', 'important');
                        modalDialog.style.setProperty('position', 'relative', 'important');
                        modalDialog.style.setProperty('left', 'auto', 'important');
                        modalDialog.style.setProperty('right', 'auto', 'important');
                        modalDialog.style.setProperty('transform', 'none', 'important');
                    }
                }, 100);
                
                adicionarLog('✅ Modal aberto com Bootstrap', 'success');
            } else {
                // Fallback para modal customizado
                modal.style.display = 'block';
                document.body.style.overflow = 'hidden';
                adicionarLog('✅ Modal aberto com fallback customizado', 'success');
            }
        }

        // Função para verificar estrutura do modal
        function verificarEstrutura() {
            const modal = document.getElementById('modalCFC');
            const modalDialog = modal?.querySelector('.modal-dialog');
            const modalContent = modal?.querySelector('.modal-content');
            const modalHeader = modal?.querySelector('.modal-header');
            const modalBody = modal?.querySelector('.modal-body');
            const modalFooter = modal?.querySelector('.modal-footer');
            
            let log = '🔍 Verificação da Estrutura do Modal:\n';
            
            if (modal) log += '✅ Modal encontrado\n';
            if (modalDialog) log += '✅ Modal Dialog encontrado\n';
            if (modalContent) log += '✅ Modal Content encontrado\n';
            if (modalHeader) log += '✅ Modal Header encontrado\n';
            if (modalBody) log += '✅ Modal Body encontrado\n';
            if (modalFooter) log += '✅ Modal Footer encontrado\n';
            
            // Verificar se o footer está dentro do modal-content
            if (modalContent && modalFooter) {
                const isFooterInside = modalContent.contains(modalFooter);
                if (isFooterInside) {
                    log += '✅ Footer está dentro do modal-content\n';
                } else {
                    log += '❌ Footer NÃO está dentro do modal-content\n';
                }
            }
            
            adicionarLog(log, 'info');
        }

        // Função para verificar CSS aplicado
        function verificarCSS() {
            const modal = document.getElementById('modalCFC');
            const modalDialog = modal?.querySelector('.modal-dialog');
            const modalContent = modal?.querySelector('.modal-content');
            const modalFooter = modal?.querySelector('.modal-footer');
            
            let log = '🎨 Verificação do CSS Aplicado:\n';
            
            if (modalDialog) {
                const computedStyle = window.getComputedStyle(modalDialog);
                log += `📏 Modal Dialog - max-width: ${computedStyle.maxWidth}\n`;
                log += `📏 Modal Dialog - width: ${computedStyle.width}\n`;
                log += `📍 Modal Dialog - position: ${computedStyle.position}\n`;
            }
            
            if (modalContent) {
                const computedStyle = window.getComputedStyle(modalContent);
                log += `📏 Modal Content - display: ${computedStyle.display}\n`;
                log += `📏 Modal Content - flex-direction: ${computedStyle.flexDirection}\n`;
            }
            
            if (modalFooter) {
                const computedStyle = window.getComputedStyle(modalFooter);
                log += `📏 Modal Footer - position: ${computedStyle.position}\n`;
                log += `📏 Modal Footer - width: ${computedStyle.width}\n`;
                log += `📍 Modal Footer - top: ${computedStyle.top}\n`;
                log += `📍 Modal Footer - bottom: ${computedStyle.bottom}\n`;
            }
            
            adicionarLog(log, 'info');
        }

        // Função para testar responsividade
        function testarResponsividade() {
            const modal = document.getElementById('modalCFC');
            const modalDialog = modal?.querySelector('.modal-dialog');
            
            let log = '📱 Teste de Responsividade:\n';
            log += `🖥️ Largura da tela: ${window.innerWidth}px\n`;
            
            if (modalDialog) {
                const computedStyle = window.getComputedStyle(modalDialog);
                log += `📏 Modal Dialog - max-width: ${computedStyle.maxWidth}\n`;
                log += `📏 Modal Dialog - width: ${computedStyle.width}\n`;
                log += `📍 Modal Dialog - margin: ${computedStyle.margin}\n`;
            }
            
            adicionarLog(log, 'info');
        }

        // Função para adicionar log
        function adicionarLog(mensagem, tipo = 'info') {
            const logContainer = document.getElementById('logContainer');
            const timestamp = new Date().toLocaleTimeString();
            
            let classe = 'text-muted';
            if (tipo === 'success') classe = 'text-success';
            if (tipo === 'error') classe = 'text-danger';
            if (tipo === 'warning') classe = 'text-warning';
            if (tipo === 'info') classe = 'text-info';
            
            const logEntry = document.createElement('div');
            logEntry.className = `mb-2 ${classe}`;
            logEntry.innerHTML = `<strong>[${timestamp}]</strong> ${mensagem}`;
            
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            adicionarLog('🚀 Sistema de teste inicializado', 'success');
            adicionarLog('📋 Modal CFC carregado e pronto para teste', 'info');
        });
    </script>
</body>
</html>
