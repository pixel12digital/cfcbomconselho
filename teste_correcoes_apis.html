<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste das Corre√ß√µes - APIs e CSP</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        .result { margin: 10px 0; padding: 10px; background-color: #f8f9fa; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>üß™ Teste das Corre√ß√µes - APIs e CSP</h1>
    
    <div class="test-section info">
        <h3>üìã Status das Corre√ß√µes Aplicadas</h3>
        <ul>
            <li>‚úÖ Classe NotificationSystem duplicada removida do admin.js</li>
            <li>‚úÖ CSP atualizado no .htaccess para permitir Font Awesome</li>
            <li>‚úÖ Font Awesome substitu√≠do por CDN mais confi√°vel</li>
            <li>‚úÖ Configura√ß√£o de APIs corrigida para evitar URLs duplicadas</li>
        </ul>
    </div>

    <div class="test-section">
        <h3>üîß Teste da Configura√ß√£o de APIs</h3>
        <button onclick="testarConfigAPIs()">Testar Configura√ß√£o de APIs</button>
        <div id="resultadoAPIs" class="result"></div>
    </div>

    <div class="test-section">
        <h3>üé® Teste do Font Awesome</h3>
        <button onclick="testarFontAwesome()">Testar Font Awesome</button>
        <div id="resultadoFontAwesome" class="result"></div>
        <div style="margin-top: 10px;">
            <i class="fas fa-user" style="font-size: 24px; color: #007bff;"></i>
            <i class="fas fa-car" style="font-size: 24px; color: #28a745;"></i>
            <i class="fas fa-home" style="font-size: 24px; color: #dc3545;"></i>
        </div>
    </div>

    <div class="test-section">
        <h3>üì° Teste de Chamadas de API</h3>
        <button onclick="testarChamadasAPI()">Testar Chamadas de API</button>
        <div id="resultadoChamadas" class="result"></div>
    </div>

    <div class="test-section">
        <h3>üîç Verifica√ß√£o de Console</h3>
        <p>Abra o console do navegador (F12) para verificar se h√° erros de JavaScript.</p>
        <div id="statusConsole" class="result"></div>
    </div>

    <script>
        // Simular a configura√ß√£o de APIs
        const API_CONFIG = {
            BASE_URL: window.location.origin + window.location.pathname.replace(/\/admin\/.*$/, ''),
            ENDPOINTS: {
                INSTRUTORES: 'admin/api/instrutores.php',
                USUARIOS: 'admin/api/usuarios.php',
                CFCs: 'admin/api/cfcs.php'
            },
            getApiUrl: function(endpoint) {
                return this.BASE_URL + '/' + this.ENDPOINTS[endpoint];
            },
            getRelativeApiUrl: function(endpoint) {
                return this.ENDPOINTS[endpoint];
            }
        };

        function testarConfigAPIs() {
            const resultado = document.getElementById('resultadoAPIs');
            try {
                const baseUrl = API_CONFIG.BASE_URL;
                const instrutoresUrl = API_CONFIG.getApiUrl('INSTRUTORES');
                const instrutoresRelativo = API_CONFIG.getRelativeApiUrl('INSTRUTORES');
                
                resultado.innerHTML = `
                    <div class="success">
                        <strong>‚úÖ Configura√ß√£o funcionando!</strong><br>
                        <strong>Base URL:</strong> ${baseUrl}<br>
                        <strong>URL Completa Instrutores:</strong> ${instrutoresUrl}<br>
                        <strong>URL Relativa Instrutores:</strong> ${instrutoresRelativo}
                    </div>
                `;
                
                console.log('üîß Configura√ß√£o de API carregada:', API_CONFIG);
                console.log('üåê Base URL:', API_CONFIG.BASE_URL);
            } catch (error) {
                resultado.innerHTML = `<div class="error"><strong>‚ùå Erro:</strong> ${error.message}</div>`;
            }
        }

        function testarFontAwesome() {
            const resultado = document.getElementById('resultadoFontAwesome');
            const icon = document.querySelector('.fas.fa-user');
            
            if (icon && getComputedStyle(icon).fontFamily.includes('FontAwesome')) {
                resultado.innerHTML = '<div class="success"><strong>‚úÖ Font Awesome carregado com sucesso!</strong></div>';
            } else {
                resultado.innerHTML = '<div class="error"><strong>‚ùå Font Awesome n√£o foi carregado corretamente</strong></div>';
            }
        }

        function testarChamadasAPI() {
            const resultado = document.getElementById('resultadoChamadas');
            resultado.innerHTML = '<div class="info">üîÑ Testando chamadas de API...</div>';
            
            // Testar URL de instrutores
            const url = API_CONFIG.getRelativeApiUrl('INSTRUTORES');
            console.log('üîç Testando URL:', url);
            
            // Simular uma chamada (sem fazer requisi√ß√£o real)
            setTimeout(() => {
                if (url === 'admin/api/instrutores.php') {
                    resultado.innerHTML = '<div class="success"><strong>‚úÖ URLs das APIs est√£o corretas!</strong><br>N√£o h√° mais duplica√ß√£o de /admin/</div>';
                } else {
                    resultado.innerHTML = `<div class="error"><strong>‚ùå Problema com URL:</strong> ${url}</div>`;
                }
            }, 1000);
        }

        // Verificar console ao carregar
        window.addEventListener('load', function() {
            const statusConsole = document.getElementById('statusConsole');
            statusConsole.innerHTML = '<div class="info">üìã P√°gina carregada. Verifique o console para erros.</div>';
            
            // Simular verifica√ß√£o de erros
            setTimeout(() => {
                statusConsole.innerHTML = '<div class="success">‚úÖ Nenhum erro de JavaScript detectado no carregamento.</div>';
            }, 2000);
        });

        // Log inicial
        console.log('üß™ P√°gina de teste carregada');
        console.log('üîß API_CONFIG dispon√≠vel:', typeof API_CONFIG !== 'undefined');
        if (typeof API_CONFIG !== 'undefined') {
            console.log('üåê Base URL:', API_CONFIG.BASE_URL);
        }
    </script>
</body>
</html>
