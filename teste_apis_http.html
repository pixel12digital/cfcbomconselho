<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste das APIs via HTTP - Instrutores</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background-color: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background-color: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .info { background-color: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
        .warning { background-color: #fff3cd; border: 1px solid #ffeaa7; color: #856404; }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="mb-4">
            <i class="fas fa-vial text-primary"></i>
            Teste das APIs via HTTP - Sistema de Instrutores
        </h1>
        
        <div class="alert alert-info">
            <i class="fas fa-info-circle"></i>
            <strong>Importante:</strong> Este arquivo deve ser acessado via HTTP (http://localhost:8080/cfc-bom-conselho/teste_apis_http.html) e n√£o diretamente no navegador.
        </div>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-users text-info"></i> Teste API Usu√°rios</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-primary mb-3" onclick="testarAPIUsuarios()">
                            <i class="fas fa-play"></i> Testar API Usu√°rios
                        </button>
                        <div id="resultadoUsuarios"></div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-building text-success"></i> Teste API CFCs</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-success mb-3" onclick="testarAPICFCs()">
                            <i class="fas fa-play"></i> Testar API CFCs
                        </button>
                        <div id="resultadoCFCs"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-cogs text-warning"></i> Teste Completo</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-warning mb-3" onclick="testarTodasAPIs()">
                            <i class="fas fa-rocket"></i> Testar Todas as APIs
                        </button>
                        <div id="resultadoCompleto"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-bug text-danger"></i> Debug - URLs das APIs</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4">
                                <strong>API Usu√°rios:</strong><br>
                                <code>admin/api/usuarios.php</code>
                            </div>
                            <div class="col-md-4">
                                <strong>API CFCs:</strong><br>
                                <code>admin/api/cfcs.php</code>
                            </div>
                            <div class="col-md-4">
                                <strong>API Instrutores:</strong><br>
                                <code>admin/api/instrutores.php</code>
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-md-6">
                                <strong>URL Completa (usu√°rios):</strong><br>
                                <code id="urlCompletaUsuarios"></code>
                            </div>
                            <div class="col-md-6">
                                <strong>URL Completa (CFCs):</strong><br>
                                <code id="urlCompletaCFCs"></code>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Mostrar URLs completas
        document.addEventListener('DOMContentLoaded', function() {
            const baseUrl = window.location.origin + window.location.pathname.replace('/teste_apis_http.html', '');
            document.getElementById('urlCompletaUsuarios').textContent = baseUrl + '/admin/api/usuarios.php';
            document.getElementById('urlCompletaCFCs').textContent = baseUrl + '/admin/api/cfcs.php';
        });

        function mostrarResultado(elementId, mensagem, tipo) {
            const elemento = document.getElementById(elementId);
            elemento.innerHTML = `<div class="test-result ${tipo}">${mensagem}</div>`;
        }

        async function testarAPIUsuarios() {
            mostrarResultado('resultadoUsuarios', '<i class="fas fa-spinner fa-spin"></i> Testando...', 'info');
            
            try {
                const response = await fetch('admin/api/usuarios.php');
                console.log('üì° Resposta da API Usu√°rios:', response);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('üìä Dados recebidos:', data);
                
                if (data.success) {
                    const usuarios = data.data;
                    const html = `
                        <div class="test-result success">
                            <i class="fas fa-check-circle"></i> <strong>API Usu√°rios funcionando!</strong><br>
                            <small>Total de usu√°rios: ${usuarios.length}</small>
                            ${usuarios.length > 0 ? '<br><small>Primeiro usu√°rio: ' + usuarios[0].nome + '</small>' : ''}
                        </div>
                    `;
                    mostrarResultado('resultadoUsuarios', html, '');
                } else {
                    mostrarResultado('resultadoUsuarios', `<i class="fas fa-exclamation-triangle"></i> <strong>Erro na API:</strong> ${data.error}`, 'error');
                }
            } catch (error) {
                console.error('‚ùå Erro ao testar API Usu√°rios:', error);
                mostrarResultado('resultadoUsuarios', `<i class="fas fa-times-circle"></i> <strong>Erro de conex√£o:</strong> ${error.message}`, 'error');
            }
        }

        async function testarAPICFCs() {
            mostrarResultado('resultadoCFCs', '<i class="fas fa-spinner fa-spin"></i> Testando...', 'info');
            
            try {
                const response = await fetch('admin/api/cfcs.php');
                console.log('üì° Resposta da API CFCs:', response);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('üìä Dados recebidos:', data);
                
                if (data.success) {
                    const cfcs = data.data;
                    const html = `
                        <div class="test-result success">
                            <i class="fas fa-check-circle"></i> <strong>API CFCs funcionando!</strong><br>
                            <small>Total de CFCs: ${cfcs.length}</small>
                            ${cfcs.length > 0 ? '<br><small>Primeiro CFC: ' + cfcs[0].nome + '</small>' : ''}
                        </div>
                    `;
                    mostrarResultado('resultadoCFCs', html, '');
                } else {
                    mostrarResultado('resultadoCFCs', `<i class="fas fa-exclamation-triangle"></i> <strong>Erro na API:</strong> ${data.error}`, 'error');
                }
            } catch (error) {
                console.error('‚ùå Erro ao testar API CFCs:', error);
                mostrarResultado('resultadoCFCs', `<i class="fas fa-times-circle"></i> <strong>Erro de conex√£o:</strong> ${error.message}`, 'error');
            }
        }

        async function testarTodasAPIs() {
            mostrarResultado('resultadoCompleto', '<i class="fas fa-spinner fa-spin"></i> Testando todas as APIs...', 'info');
            
            let resultados = [];
            
            // Testar API Usu√°rios
            try {
                const responseUsuarios = await fetch('admin/api/usuarios.php');
                if (responseUsuarios.ok) {
                    const dataUsuarios = await responseUsuarios.json();
                    if (dataUsuarios.success) {
                        resultados.push(`‚úÖ Usu√°rios: ${dataUsuarios.data.length} encontrados`);
                    } else {
                        resultados.push(`‚ùå Usu√°rios: ${dataUsuarios.error}`);
                    }
                } else {
                    resultados.push(`‚ùå Usu√°rios: HTTP ${responseUsuarios.status}`);
                }
            } catch (error) {
                resultados.push(`‚ùå Usu√°rios: ${error.message}`);
            }
            
            // Testar API CFCs
            try {
                const responseCFCs = await fetch('admin/api/cfcs.php');
                if (responseCFCs.ok) {
                    const dataCFCs = await responseCFCs.json();
                    if (dataCFCs.success) {
                        resultados.push(`‚úÖ CFCs: ${dataCFCs.data.length} encontrados`);
                    } else {
                        resultados.push(`‚ùå CFCs: ${dataCFCs.error}`);
                    }
                } else {
                    resultados.push(`‚ùå CFCs: HTTP ${responseCFCs.status}`);
                }
            } catch (error) {
                resultados.push(`‚ùå CFCs: ${error.message}`);
            }
            
            // Testar API Instrutores
            try {
                const responseInstrutores = await fetch('admin/api/instrutores.php');
                if (responseInstrutores.ok) {
                    const dataInstrutores = await responseInstrutores.json();
                    if (dataInstrutores.success) {
                        resultados.push(`‚úÖ Instrutores: ${dataInstrutores.data ? dataInstrutores.data.length : 0} encontrados`);
                    } else {
                        resultados.push(`‚ùå Instrutores: ${dataInstrutores.error}`);
                    }
                } else {
                    resultados.push(`‚ùå Instrutores: HTTP ${responseInstrutores.status}`);
                }
            } catch (error) {
                resultados.push(`‚ùå Instrutores: ${error.message}`);
            }
            
            const html = `
                <div class="test-result info">
                    <i class="fas fa-clipboard-list"></i> <strong>Resultado dos Testes:</strong><br>
                    ${resultados.join('<br>')}
                </div>
            `;
            mostrarResultado('resultadoCompleto', html, '');
        }

        // Testar automaticamente ao carregar a p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                testarTodasAPIs();
            }, 1000);
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
