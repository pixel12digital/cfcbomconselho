<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - Total de Horas</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .debug-section { background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        .info { color: #17a2b8; }
        .console { background: #000; color: #0f0; padding: 10px; font-family: monospace; height: 300px; overflow-y: auto; }
        .test-button { padding: 10px 20px; background: #007bff; color: white; border: none; cursor: pointer; margin: 5px; }
    </style>
</head>
<body>
    <h1>🔧 Debug - Total de Horas</h1>
    
    <div class="debug-section">
        <h3>📋 Problema Atual:</h3>
        <p>Disciplina "Disciplina Teste" tem 20h, mas "Total de horas: 0h"</p>
    </div>

    <div class="debug-section">
        <h3>🧪 Testes:</h3>
        <button class="test-button" onclick="testarFuncao()">🔍 Testar Função carregarTotalHorasDoBanco</button>
        <button class="test-button" onclick="testarAPI()">📡 Testar API Diretamente</button>
        <button class="test-button" onclick="testarElemento()">🎯 Testar Elemento HTML</button>
        <button class="test-button" onclick="executarFuncao()">▶️ Executar Função Manualmente</button>
    </div>

    <div class="debug-section">
        <h3>📊 Console de Debug:</h3>
        <div class="console" id="debug-console">
            Clique nos botões acima para executar os testes...<br>
        </div>
    </div>

    <script>
        function log(message, type = 'info') {
            const console = document.getElementById('debug-console');
            const time = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ff4444' : type === 'success' ? '#44ff44' : type === 'warning' ? '#ffff44' : '#4444ff';
            console.innerHTML += `<br><span style="color: ${color}">[${time}] ${message}</span>`;
            console.scrollTop = console.scrollHeight;
        }

        function testarFuncao() {
            log('🔍 Testando se a função carregarTotalHorasDoBanco existe...');
            
            if (typeof carregarTotalHorasDoBanco === 'function') {
                log('✅ Função carregarTotalHorasDoBanco encontrada', 'success');
                
                try {
                    log('🔧 Executando função...');
                    carregarTotalHorasDoBanco();
                    log('✅ Função executada sem erros', 'success');
                } catch (error) {
                    log(`❌ Erro ao executar função: ${error.message}`, 'error');
                }
            } else {
                log('❌ Função carregarTotalHorasDoBanco NÃO encontrada', 'error');
                log('ℹ️ A função pode não ter sido carregada ainda', 'warning');
            }
        }

        function testarAPI() {
            log('📡 Testando API diretamente...');
            
            fetch('/cfc-bom-conselho/admin/api/disciplinas-clean.php?acao=listar')
                .then(response => {
                    log(`📡 Resposta da API: ${response.status} ${response.statusText}`, 'success');
                    return response.json();
                })
                .then(data => {
                    log(`📊 Dados recebidos:`, 'success');
                    log(`  - Sucesso: ${data.sucesso}`, 'info');
                    log(`  - Disciplinas: ${data.disciplinas ? data.disciplinas.length : 0}`, 'info');
                    
                    if (data.sucesso && data.disciplinas) {
                        let total = 0;
                        data.disciplinas.forEach(d => {
                            const horas = parseInt(d.carga_horaria_padrao) || 0;
                            total += horas;
                            log(`  - ${d.nome}: ${horas}h`, 'info');
                        });
                        log(`📊 Total calculado: ${total}h`, 'success');
                    }
                })
                .catch(error => {
                    log(`❌ Erro na API: ${error.message}`, 'error');
                });
        }

        function testarElemento() {
            log('🎯 Testando elemento HTML...');
            
            // Verificar se estamos na página correta
            if (!window.location.href.includes('turmas-teoricas')) {
                log('❌ Não estamos na página turmas-teoricas', 'error');
                log('ℹ️ Abra: admin/?page=turmas-teoricas&acao=nova&step=1', 'warning');
                return;
            }
            
            const elemento = document.getElementById('total-horas-disciplinas');
            if (elemento) {
                log('✅ Elemento #total-horas-disciplinas encontrado', 'success');
                log(`📊 Valor atual: "${elemento.textContent}"`, 'info');
                log(`🎨 HTML: <${elemento.tagName} id="${elemento.id}">${elemento.textContent}</${elemento.tagName}>`, 'info');
            } else {
                log('❌ Elemento #total-horas-disciplinas NÃO encontrado', 'error');
                
                // Procurar elementos similares
                const alternativas = [
                    'total-horas-disciplinas',
                    '[id*="total"]',
                    '[id*="horas"]',
                    '.text-primary strong'
                ];
                
                alternativas.forEach(seletor => {
                    const elementos = document.querySelectorAll(seletor);
                    if (elementos.length > 0) {
                        log(`🔍 Encontrados ${elementos.length} elementos com seletor "${seletor}":`, 'warning');
                        elementos.forEach((el, i) => {
                            log(`  ${i + 1}. <${el.tagName} id="${el.id}">${el.textContent}</${el.tagName}>`, 'info');
                        });
                    }
                });
            }
        }

        function executarFuncao() {
            log('▶️ Executando função manualmente...');
            
            if (typeof carregarTotalHorasDoBanco === 'function') {
                carregarTotalHorasDoBanco();
            } else {
                // Executar manualmente
                log('🔧 Executando manualmente...');
                
                fetch('/cfc-bom-conselho/admin/api/disciplinas-clean.php?acao=listar')
                    .then(response => response.json())
                    .then(data => {
                        if (data.sucesso && data.disciplinas) {
                            let totalHorasBanco = 0;
                            data.disciplinas.forEach(disciplina => {
                                totalHorasBanco += parseInt(disciplina.carga_horaria_padrao) || 0;
                            });
                            
                            log(`📊 Total calculado: ${totalHorasBanco}h`, 'success');
                            
                            const totalHorasElement = document.getElementById('total-horas-disciplinas');
                            if (totalHorasElement) {
                                totalHorasElement.textContent = totalHorasBanco;
                                log(`✅ Elemento atualizado para: ${totalHorasBanco}h`, 'success');
                            } else {
                                log('❌ Elemento não encontrado para atualizar', 'error');
                            }
                        }
                    })
                    .catch(error => {
                        log(`❌ Erro: ${error.message}`, 'error');
                    });
            }
        }

        // Executar testes automáticos
        window.addEventListener('load', function() {
            log('📄 Página de debug carregada', 'success');
            log('ℹ️ Abra a página turmas-teoricas e execute os testes', 'info');
        });
    </script>
</body>
</html>
