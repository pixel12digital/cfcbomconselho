<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - C√°lculo de Horas</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .info { color: #17a2b8; }
        .console { background: #000; color: #0f0; padding: 10px; font-family: monospace; height: 200px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>üîß Teste - C√°lculo de Total de Horas</h1>
    
    <div class="test-section">
        <h3>üìã Problema Identificado:</h3>
        <p>As disciplinas t√™m carga hor√°ria definida (65h total), mas o sistema mostra "Total de horas: 0h".</p>
    </div>

    <div class="test-section">
        <h3>üîç An√°lise do C√≥digo:</h3>
        <p>A fun√ß√£o <code>atualizarPreview()</code> est√° procurando por:</p>
        <ul>
            <li><strong>Elementos:</strong> <code>.disciplina-item</code></li>
            <li><strong>Select:</strong> <code>select</code> dentro de cada item</li>
            <li><strong>Input horas:</strong> <code>.disciplina-horas</code></li>
            <li><strong>Elemento total:</strong> <code>#total-horas-disciplinas</code></li>
        </ul>
    </div>

    <div class="test-section">
        <h3>‚ö†Ô∏è Poss√≠veis Causas:</h3>
        <ol>
            <li><strong>Elementos n√£o encontrados:</strong> A fun√ß√£o n√£o est√° encontrando os elementos corretos</li>
            <li><strong>Dados n√£o carregados:</strong> As disciplinas n√£o est√£o sendo carregadas no select</li>
            <li><strong>Fun√ß√£o n√£o executada:</strong> A fun√ß√£o n√£o est√° sendo chamada quando deveria</li>
            <li><strong>Conflito de seletores:</strong> M√∫ltiplas vers√µes da fun√ß√£o</li>
        </ol>
    </div>

    <div class="test-section">
        <h3>üß™ Teste Manual:</h3>
        <button onclick="testarElementos()">üîç Verificar Elementos no DOM</button>
        <button onclick="testarCalculo()">üßÆ Testar C√°lculo Manual</button>
        <button onclick="verificarConsole()">üìã Verificar Console</button>
    </div>

    <div class="test-section">
        <h3>üìä Console de Teste:</h3>
        <div class="console" id="test-console">
            Clique nos bot√µes acima para executar os testes...<br>
        </div>
    </div>

    <div class="test-section">
        <h3>üîß Solu√ß√µes Propostas:</h3>
        <ol>
            <li><strong>Verificar se os elementos existem</strong> quando a fun√ß√£o √© executada</li>
            <li><strong>Garantir que as disciplinas s√£o carregadas</strong> antes do c√°lculo</li>
            <li><strong>Adicionar logs detalhados</strong> para debug</li>
            <li><strong>Executar c√°lculo inicial</strong> quando a p√°gina carrega</li>
        </ol>
    </div>

    <script>
        function log(message) {
            const console = document.getElementById('test-console');
            const time = new Date().toLocaleTimeString();
            console.innerHTML += `<br>[${time}] ${message}`;
            console.scrollTop = console.scrollHeight;
        }

        function testarElementos() {
            log('üîç Testando elementos no DOM...');
            
            // Verificar se estamos na p√°gina correta
            if (window.location.href.includes('turmas-teoricas')) {
                log('‚úÖ Estamos na p√°gina correta');
                
                // Verificar elementos
                const disciplinaItems = document.querySelectorAll('.disciplina-item');
                log(`üìã Encontrados ${disciplinaItems.length} elementos .disciplina-item`);
                
                const totalHorasElement = document.getElementById('total-horas-disciplinas');
                if (totalHorasElement) {
                    log('‚úÖ Elemento #total-horas-disciplinas encontrado');
                    log(`üìä Valor atual: ${totalHorasElement.textContent}h`);
                } else {
                    log('‚ùå Elemento #total-horas-disciplinas N√ÉO encontrado');
                }
                
                // Verificar disciplinas
                disciplinaItems.forEach((item, index) => {
                    const select = item.querySelector('select');
                    const horasInput = item.querySelector('.disciplina-horas');
                    
                    log(`üìã Disciplina ${index + 1}:`);
                    log(`  - Select: ${select ? '‚úÖ' : '‚ùå'} (valor: ${select?.value || 'n√£o selecionado'})`);
                    log(`  - Input horas: ${horasInput ? '‚úÖ' : '‚ùå'} (valor: ${horasInput?.value || 'vazio'})`);
                });
                
            } else {
                log('‚ùå N√£o estamos na p√°gina turmas-teoricas');
                log('‚ÑπÔ∏è Abra a p√°gina: admin/?page=turmas-teoricas&acao=nova&step=1');
            }
        }

        function testarCalculo() {
            log('üßÆ Testando c√°lculo manual...');
            
            if (window.location.href.includes('turmas-teoricas')) {
                // Simular o c√°lculo da fun√ß√£o atualizarPreview
                const disciplinas = document.querySelectorAll('.disciplina-item');
                let totalHoras = 0;
                let disciplinasComHoras = [];
                
                log(`üîç Analisando ${disciplinas.length} disciplinas...`);
                
                disciplinas.forEach((item, index) => {
                    const select = item.querySelector('select');
                    const horasInput = item.querySelector('.disciplina-horas');
                    
                    if (select && select.value && horasInput && horasInput.value) {
                        const selectedOption = select.options[select.selectedIndex];
                        const horas = parseInt(horasInput.value) || 0;
                        
                        totalHoras += horas;
                        disciplinasComHoras.push({
                            nome: selectedOption.textContent,
                            horas: horas
                        });
                        
                        log(`‚úÖ Disciplina ${index + 1}: ${selectedOption.textContent} = ${horas}h`);
                    } else {
                        log(`‚ö†Ô∏è Disciplina ${index + 1}: dados incompletos`);
                        if (select) log(`  - Select valor: ${select.value}`);
                        if (horasInput) log(`  - Input valor: ${horasInput.value}`);
                    }
                });
                
                log(`üìä Total calculado: ${totalHoras}h`);
                log(`üìã Disciplinas com horas: ${disciplinasComHoras.length}`);
                
                // Atualizar o elemento
                const totalHorasElement = document.getElementById('total-horas-disciplinas');
                if (totalHorasElement) {
                    totalHorasElement.textContent = totalHoras;
                    log(`‚úÖ Elemento atualizado para ${totalHoras}h`);
                } else {
                    log('‚ùå N√£o foi poss√≠vel atualizar - elemento n√£o encontrado');
                }
                
            } else {
                log('‚ùå Execute este teste na p√°gina turmas-teoricas');
            }
        }

        function verificarConsole() {
            log('üìã Verificando console do navegador...');
            log('‚ÑπÔ∏è Abra o DevTools (F12) e verifique:');
            log('  - Se h√° erros JavaScript');
            log('  - Se a fun√ß√£o atualizarPreview() est√° sendo chamada');
            log('  - Se os elementos est√£o sendo encontrados');
            log('  - Se os dados das disciplinas est√£o sendo carregados');
        }

        // Executar teste autom√°tico quando a p√°gina carrega
        window.addEventListener('load', function() {
            log('üìÑ P√°gina de teste carregada');
            log('‚ÑπÔ∏è Abra a p√°gina turmas-teoricas e execute os testes');
        });
    </script>
</body>
</html>
