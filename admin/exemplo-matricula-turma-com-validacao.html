<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exemplo - Matr√≠cula em Turma com Valida√ß√£o de Exames</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            background: #f8f9fa;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .code-block {
            background: #f4f4f4;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            margin: 15px 0;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        .info { color: #17a2b8; }
        .highlight {
            background: #fff3cd;
            padding: 15px;
            border-left: 4px solid #ffc107;
            margin: 20px 0;
            border-radius: 4px;
        }
        .section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
        }
        h1 { color: #023A8D; }
        h2 { color: #023A8D; border-bottom: 2px solid #F7931E; padding-bottom: 10px; }
        h3 { color: #023A8D; }
        .btn {
            display: inline-block;
            padding: 10px 20px;
            background: #023A8D;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            margin: 10px 5px;
        }
        .btn:hover {
            background: #1a4fa0;
        }
        .btn-warning {
            background: #F7931E;
        }
        .btn-warning:hover {
            background: #e8840d;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü©∫ Matr√≠cula em Turma com Valida√ß√£o de Exames</h1>
        
        <div class="highlight">
            <strong>üìã Nova Funcionalidade Implementada:</strong> 
            Agora o sistema verifica automaticamente se o aluno foi aprovado nos exames m√©dico e psicol√≥gico antes de permitir a matr√≠cula em turmas. Caso os exames n√£o estejam aprovados, uma mensagem amig√°vel √© exibida explicando o motivo.
        </div>

        <div class="section">
            <h2>üîß Como Usar via Interface</h2>
            <p>A valida√ß√£o acontece automaticamente quando voc√™ tenta matricular um aluno em uma turma atrav√©s da interface administrativa:</p>
            
            <ol>
                <li>Acesse a p√°gina de <strong>Gest√£o de Turmas</strong></li>
                <li>Selecione uma turma ativa</li>
                <li>Clique em "Matricular Aluno"</li>
                <li>Selecione o aluno desejado</li>
                <li>O sistema verificar√° automaticamente os exames antes de efetuar a matr√≠cula</li>
            </ol>
        </div>

        <div class="section">
            <h2>üåê Como Usar via API</h2>
            
            <h3>Endpoint:</h3>
            <div class="code-block">POST /admin/api/turmas.php</div>
            
            <h3>Estrutura da Requisi√ß√£o:</h3>
            <div class="code-block">{
    "acao": "matricular_aluno",
    "turma_id": 123,
    "aluno_id": 456
}</div>

            <h3>Exemplo de Uso com JavaScript:</h3>
            <div class="code-block">async function matricularAlunoNaTurma(turmaId, alunoId) {
    try {
        const response = await fetch('/admin/api/turmas.php', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                acao: 'matricular_aluno',
                turma_id: turmaId,
                aluno_id: alunoId
            })
        });
        
        const resultado = await response.json();
        
        if (resultado.sucesso) {
            alert('‚úÖ ' + resultado.mensagem);
        } else {
            alert('‚ùå ' + resultado.mensagem);
        }
        
        return resultado;
    } catch (error) {
        console.error('Erro:', error);
        alert('Erro ao comunicar com o servidor');
    }
}</div>
        </div>

        <div class="section">
            <h2>üìä Poss√≠veis Respostas da API</h2>

            <h3 class="success">‚úÖ Sucesso (HTTP 201)</h3>
            <div class="code-block">{
    "sucesso": true,
    "mensagem": "‚úÖ Aluno matriculado com sucesso na turma!"
}</div>

            <h3 class="error">‚ùå Exames N√£o Aprovados (HTTP 400)</h3>
            <div class="code-block">{
    "sucesso": false,
    "mensagem": "ü©∫ Para matricular o aluno na turma, √© necess√°rio que os exames estejam aprovados:\n‚Ä¢ Exame m√©dico: Ainda n√£o realizado\n‚Ä¢ Exame psicol√≥gico: Reprovado (inapto)\n\nüí° Providencie a aprova√ß√£o dos exames pendentes antes de matricular o aluno na turma.",
    "tipo_erro": "exames_pendentes",
    "detalhes": {
        "exame_medico": null,
        "exame_psicologico": "inapto"
    }
}</div>

            <h3 class="warning">‚ö†Ô∏è Aluno J√° Matriculado (HTTP 400)</h3>
            <div class="code-block">{
    "sucesso": false,
    "mensagem": "üìö Este aluno j√° est√° matriculado nesta turma.",
    "tipo_erro": "ja_matriculado"
}</div>

            <h3 class="info">üìã Turma Inativa (HTTP 400)</h3>
            <div class="code-block">{
    "sucesso": false,
    "mensagem": "üìã A turma \"Turma B - Manh√£\" n√£o est√° ativa para novas matr√≠culas.",
    "tipo_erro": "turma_inativa"
}</div>
        </div>

        <div class="section">
            <h2>üß™ Status de Exames Aceitos</h2>
            
            <h3 class="success">‚úÖ Aprovados (Permitem Matr√≠cula):</h3>
            <ul>
                <li><code>"apto"</code> - Aluno apto no exame</li>
                <li><code>"aprovado"</code> - Aluno aprovado no exame</li>
            </ul>

            <h3 class="error">‚ùå Reprovados (Bloqueiam Matr√≠cula):</h3>
            <ul>
                <li><code>"inapto"</code> - Aluno inapto no exame</li>
                <li><code>"inapto_temporario"</code> - Aluno temporariamente inapto</li>
                <li><code>"reprovado"</code> - Aluno reprovado no exame</li>
                <li><code>"pendente"</code> - Exame ainda n√£o conclu√≠do</li>
                <li><code>null</code> ou vazio - Exame n√£o realizado</li>
            </ul>
        </div>

        <div class="section">
            <h2>üîç Exemplo de Tratamento de Erros</h2>
            <div class="code-block">function exibirResultadoMatricula(resultado) {
    if (resultado.sucesso) {
        // Matr√≠cula realizada com sucesso
        mostrarMensagemSucesso(resultado.mensagem);
        atualizarListaTurmas();
    } else {
        // Erro na matr√≠cula - tratar diferentes tipos
        switch (resultado.tipo_erro) {
            case 'exames_pendentes':
                mostrarModalExamesPendentes(resultado.detalhes);
                break;
            case 'ja_matriculado':
                mostrarMensagemInfo(resultado.mensagem);
                break;
            case 'turma_inativa':
                mostrarMensagemAviso(resultado.mensagem);
                break;
            default:
                mostrarMensagemErro(resultado.mensagem);
        }
    }
}</div>
        </div>

        <div class="section">
            <h2>üß™ Testar a Implementa√ß√£o</h2>
            <p>Para testar se a valida√ß√£o est√° funcionando corretamente:</p>
            
            <a href="test-validacao-exames-turma.php?test=1" class="btn" target="_blank">
                üß™ Executar Testes Automatizados
            </a>
            
            <p><small><strong>Nota:</strong> O script de teste criar√° dados tempor√°rios que ser√£o removidos automaticamente ao final.</small></p>
        </div>

        <div class="section">
            <h2>üìù Configura√ß√µes do Sistema</h2>
            <p>A valida√ß√£o utiliza as seguintes tabelas e campos:</p>
            
            <h3>Tabela: <code>alunos</code></h3>
            <ul>
                <li><code>exame_medico</code> - Status do exame m√©dico</li>
                <li><code>exame_psicologico</code> - Status do exame psicol√≥gico</li>
                <li><code>data_exame_medico</code> - Data do exame m√©dico</li>
                <li><code>data_exame_psicologico</code> - Data do exame psicol√≥gico</li>
            </ul>

            <h3>Tabela: <code>turma_alunos</code></h3>
            <ul>
                <li><code>turma_id</code> - ID da turma</li>
                <li><code>aluno_id</code> - ID do aluno</li>
                <li><code>status</code> - Status da matr√≠cula</li>
                <li><code>data_matricula</code> - Data da matr√≠cula</li>
            </ul>
        </div>

        <div class="highlight">
            <strong>üí° Dica:</strong> Esta funcionalidade melhora significativamente a qualidade do controle acad√™mico, garantindo que apenas alunos com exames aprovados possam iniciar as aulas te√≥ricas, conforme exigido pela legisla√ß√£o de tr√¢nsito.
        </div>
    </div>
</body>
</html>
