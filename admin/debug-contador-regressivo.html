<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - Contador Regressivo</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f8f9fa; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .debug-section { margin: 20px 0; padding: 15px; border: 1px solid #dee2e6; border-radius: 5px; }
        .success { color: #28a745; font-weight: bold; }
        .error { color: #dc3545; font-weight: bold; }
        .warning { color: #ffc107; font-weight: bold; }
        .info { color: #17a2b8; font-weight: bold; }
        .code { background: #f8f9fa; padding: 10px; border-radius: 4px; font-family: monospace; border: 1px solid #dee2e6; }
        .btn { padding: 8px 16px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: black; }
        .form-control { padding: 8px; border: 1px solid #ced4da; border-radius: 4px; margin: 5px; }
        .form-select { padding: 8px; border: 1px solid #ced4da; border-radius: 4px; margin: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Debug - Contador Regressivo</h1>
        
        <div class="debug-section">
            <h3>üìã Simula√ß√£o do Sistema</h3>
            
            <div>
                <label>Tipo de Curso:</label>
                <select id="curso_tipo" class="form-select" onchange="debugAtualizarContador()">
                    <option value="">Selecione o curso...</option>
                    <option value="formacao_45h">Forma√ß√£o 45h</option>
                    <option value="formacao_acc_20h">Forma√ß√£o ACC 20h</option>
                    <option value="reciclagem_infrator">Reciclagem Infrator</option>
                    <option value="atualizacao">Atualiza√ß√£o</option>
                </select>
            </div>
            
            <div>
                <label>Disciplina 1:</label>
                <select id="disciplina_1" class="form-select" onchange="debugAtualizarContador()">
                    <option value="">Selecione...</option>
                    <option value="1" data-aulas="18">Legisla√ß√£o de Tr√¢nsito (18h)</option>
                    <option value="2" data-aulas="16">Dire√ß√£o Defensiva (16h)</option>
                    <option value="3" data-aulas="11">Meio Ambiente (11h)</option>
                </select>
            </div>
            
            <div>
                <label>Disciplina 2:</label>
                <select id="disciplina_2" class="form-select" onchange="debugAtualizarContador()">
                    <option value="">Selecione...</option>
                    <option value="1" data-aulas="18">Legisla√ß√£o de Tr√¢nsito (18h)</option>
                    <option value="2" data-aulas="16">Dire√ß√£o Defensiva (16h)</option>
                    <option value="3" data-aulas="11">Meio Ambiente (11h)</option>
                </select>
            </div>
            
            <div>
                <strong>Total de horas: <span id="total-horas-disciplinas" style="color: #007bff; font-size: 1.2em;">0h</span></strong>
            </div>
            
            <button class="btn btn-warning" onclick="debugAtualizarContador()">üîÑ Atualizar Contador</button>
        </div>

        <div class="debug-section">
            <h3>üîç Logs de Debug</h3>
            <div id="debug-logs" style="background: #f8f9fa; padding: 10px; border-radius: 4px; max-height: 300px; overflow-y: auto;">
                <p class="info">Logs aparecer√£o aqui...</p>
            </div>
            <button class="btn btn-primary" onclick="limparLogs()">üóëÔ∏è Limpar Logs</button>
        </div>

        <div class="debug-section">
            <h3>üß™ Testes Autom√°ticos</h3>
            <button class="btn btn-success" onclick="executarTestes()">‚ñ∂Ô∏è Executar Testes</button>
            <div id="resultado-testes"></div>
        </div>
    </div>

    <script>
        // Implementar as fun√ß√µes do sistema
        function obterCargaHorariaCurso(tipoCurso) {
            const cargasHorarias = {
                'formacao_45h': 45,
                'formacao_acc_20h': 20,
                'reciclagem_infrator': 30,
                'atualizacao': 15
            };
            
            const cargaHoraria = cargasHorarias[tipoCurso] || 0;
            debugLog(`üìä Carga hor√°ria do curso ${tipoCurso}: ${cargaHoraria}h`);
            return cargaHoraria;
        }

        function atualizarTotalHorasRegressivo() {
            debugLog('üîÑ Atualizando total de horas (contador regressivo)...');
            
            const cursoSelect = document.getElementById('curso_tipo');
            const totalHorasElement = document.getElementById('total-horas-disciplinas');
            
            if (!cursoSelect || !totalHorasElement) {
                debugLog('‚ùå Elementos n√£o encontrados para contador regressivo');
                return;
            }
            
            const tipoCurso = cursoSelect.value;
            if (!tipoCurso) {
                debugLog('‚ÑπÔ∏è Nenhum curso selecionado');
                totalHorasElement.textContent = '0h';
                return;
            }
            
            // Obter carga hor√°ria total do curso
            const cargaHorariaTotal = obterCargaHorariaCurso(tipoCurso);
            
            // Calcular horas j√° utilizadas pelas disciplinas selecionadas
            let horasUtilizadas = 0;
            const disciplinas = document.querySelectorAll('select[id^="disciplina_"]');
            
            disciplinas.forEach((select, index) => {
                if (select.value) {
                    const selectedOption = select.options[select.selectedIndex];
                    const horasDisciplina = parseInt(selectedOption.dataset.aulas) || 0;
                    horasUtilizadas += horasDisciplina;
                    debugLog(`üìö Disciplina ${index + 1} (${selectedOption.textContent}): ${horasDisciplina}h`);
                }
            });
            
            // Calcular horas restantes
            const horasRestantes = Math.max(0, cargaHorariaTotal - horasUtilizadas);
            
            // Atualizar exibi√ß√£o
            totalHorasElement.textContent = `${horasRestantes}h`;
            
            // Armazenar valores para uso posterior
            window.cargaHorariaTotalCurso = cargaHorariaTotal;
            window.horasUtilizadasDisciplinas = horasUtilizadas;
            
            debugLog(`üìä Total: ${cargaHorariaTotal}h - Utilizadas: ${horasUtilizadas}h = Restantes: ${horasRestantes}h`);
            
            // Feedback visual baseado no status
            if (horasRestantes === 0) {
                totalHorasElement.style.color = '#28a745'; // Verde - curso completo
                totalHorasElement.title = '‚úÖ Curso completo!';
                debugLog('‚úÖ Curso completo!');
            } else if (horasRestantes <= cargaHorariaTotal * 0.2) {
                totalHorasElement.style.color = '#ffc107'; // Amarelo - quase completo
                totalHorasElement.title = `‚ö†Ô∏è Faltam apenas ${horasRestantes}h para completar o curso`;
                debugLog(`‚ö†Ô∏è Quase completo! Faltam ${horasRestantes}h`);
            } else {
                totalHorasElement.style.color = '#007bff'; // Azul - normal
                totalHorasElement.title = `${horasRestantes}h restantes de ${cargaHorariaTotal}h`;
                debugLog(`üìä Normal: ${horasRestantes}h restantes`);
            }
            
            return {
                cargaHorariaTotal,
                horasUtilizadas,
                horasRestantes,
                status: horasRestantes === 0 ? 'completo' : horasRestantes <= cargaHorariaTotal * 0.2 ? 'quase_completo' : 'normal'
            };
        }

        function debugAtualizarContador() {
            debugLog('üîß [DEBUG] Fun√ß√£o debugAtualizarContador chamada');
            const resultado = atualizarTotalHorasRegressivo();
            debugLog('üîß [DEBUG] Resultado:', resultado);
        }

        function debugLog(message, data = null) {
            const logsContainer = document.getElementById('debug-logs');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<span style="color: #666;">[${timestamp}]</span> ${message}`;
            if (data) {
                logEntry.innerHTML += ` <span style="color: #007bff;">${JSON.stringify(data)}</span>`;
            }
            logsContainer.appendChild(logEntry);
            logsContainer.scrollTop = logsContainer.scrollHeight;
            
            // Tamb√©m logar no console
            console.log(`[${timestamp}] ${message}`, data || '');
        }

        function limparLogs() {
            document.getElementById('debug-logs').innerHTML = '<p class="info">Logs limpos...</p>';
        }

        function executarTestes() {
            const resultado = document.getElementById('resultado-testes');
            let html = '<div style="margin-top: 15px;"><h4>üß™ Resultados dos Testes:</h4>';
            
            // Teste 1: Curso 45h sem disciplinas
            document.getElementById('curso_tipo').value = 'formacao_45h';
            document.getElementById('disciplina_1').value = '';
            document.getElementById('disciplina_2').value = '';
            const teste1 = atualizarTotalHorasRegressivo();
            
            html += `<div style="padding: 10px; margin: 5px 0; border: 1px solid #dee2e6; border-radius: 4px;">
                <strong>Teste 1:</strong> Curso 45h sem disciplinas<br>
                Resultado: ${teste1.horasRestantes}h (esperado: 45h) - 
                <span style="color: ${teste1.horasRestantes === 45 ? '#28a745' : '#dc3545'};">
                    ${teste1.horasRestantes === 45 ? '‚úÖ PASSOU' : '‚ùå FALHOU'}
                </span>
            </div>`;
            
            // Teste 2: Curso 45h com 1 disciplina (18h)
            document.getElementById('disciplina_1').value = '1';
            const teste2 = atualizarTotalHorasRegressivo();
            
            html += `<div style="padding: 10px; margin: 5px 0; border: 1px solid #dee2e6; border-radius: 4px;">
                <strong>Teste 2:</strong> Curso 45h com 1 disciplina (18h)<br>
                Resultado: ${teste2.horasRestantes}h (esperado: 27h) - 
                <span style="color: ${teste2.horasRestantes === 27 ? '#28a745' : '#dc3545'};">
                    ${teste2.horasRestantes === 27 ? '‚úÖ PASSOU' : '‚ùå FALHOU'}
                </span>
            </div>`;
            
            // Teste 3: Curso 45h com 2 disciplinas (34h)
            document.getElementById('disciplina_2').value = '2';
            const teste3 = atualizarTotalHorasRegressivo();
            
            html += `<div style="padding: 10px; margin: 5px 0; border: 1px solid #dee2e6; border-radius: 4px;">
                <strong>Teste 3:</strong> Curso 45h com 2 disciplinas (34h)<br>
                Resultado: ${teste3.horasRestantes}h (esperado: 11h) - 
                <span style="color: ${teste3.horasRestantes === 11 ? '#28a745' : '#dc3545'};">
                    ${teste3.horasRestantes === 11 ? '‚úÖ PASSOU' : '‚ùå FALHOU'}
                </span>
            </div>`;
            
            html += '</div>';
            resultado.innerHTML = html;
            
            debugLog('üß™ Testes executados com sucesso!');
        }

        // Inicializar
        document.addEventListener('DOMContentLoaded', function() {
            debugLog('üöÄ Sistema de debug carregado!');
            debugLog('üîß Fun√ß√£o atualizarTotalHorasRegressivo dispon√≠vel:', typeof atualizarTotalHorasRegressivo === 'function');
        });
    </script>
</body>
</html>
