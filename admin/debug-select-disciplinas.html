<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - Select Disciplinas</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .debug-section { background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        .info { color: #17a2b8; }
        .console { background: #000; color: #0f0; padding: 10px; font-family: monospace; height: 400px; overflow-y: auto; }
        .test-button { padding: 10px 20px; background: #007bff; color: white; border: none; cursor: pointer; margin: 5px; }
    </style>
</head>
<body>
    <h1>🔧 Debug - Select Disciplinas</h1>
    
    <div class="debug-section">
        <h3>📋 Problema Atual:</h3>
        <p>Select de disciplinas mostra "Carregando disciplinas..." e não carrega as opções</p>
    </div>

    <div class="debug-section">
        <h3>🧪 Testes:</h3>
        <button class="test-button" onclick="testarAPI()">📡 Testar API Disciplinas</button>
        <button class="test-button" onclick="testarSelect()">🎯 Testar Elemento Select</button>
        <button class="test-button" onclick="testarFuncoes()">🔧 Testar Funções</button>
        <button class="test-button" onclick="forcarCarregamento()">▶️ Forçar Carregamento</button>
    </div>

    <div class="debug-section">
        <h3>📊 Console de Debug:</h3>
        <div class="console" id="debug-console">
            Clique nos botões acima para executar os testes...<br>
        </div>
    </div>

    <script>
        function log(message, type = 'info') {
            const console = document.getElementById('debug-console');
            const time = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ff4444' : type === 'success' ? '#44ff44' : type === 'warning' ? '#ffff44' : '#4444ff';
            console.innerHTML += `<br><span style="color: ${color}">[${time}] ${message}</span>`;
            console.scrollTop = console.scrollHeight;
        }

        function testarAPI() {
            log('📡 Testando API de disciplinas...');
            
            fetch('/cfc-bom-conselho/admin/api/disciplinas-clean.php?acao=listar')
                .then(response => {
                    log(`📡 Resposta: ${response.status} ${response.statusText}`, 'success');
                    return response.json();
                })
                .then(data => {
                    log(`📊 Dados recebidos:`, 'success');
                    log(`  - Sucesso: ${data.sucesso}`, 'info');
                    log(`  - Disciplinas: ${data.disciplinas ? data.disciplinas.length : 0}`, 'info');
                    
                    if (data.sucesso && data.disciplinas) {
                        data.disciplinas.forEach((d, i) => {
                            log(`  ${i + 1}. ${d.nome} (${d.codigo})`, 'info');
                        });
                    }
                })
                .catch(error => {
                    log(`❌ Erro na API: ${error.message}`, 'error');
                });
        }

        function testarSelect() {
            log('🎯 Testando elemento select...');
            
            if (!window.location.href.includes('turmas-teoricas')) {
                log('❌ Não estamos na página turmas-teoricas', 'error');
                return;
            }
            
            // Procurar o select principal
            const select = document.querySelector('select[name="disciplina_0"]');
            if (select) {
                log('✅ Select principal encontrado', 'success');
                log(`📊 Opções: ${select.options.length}`, 'info');
                log(`📝 Valor atual: "${select.value}"`, 'info');
                log(`📄 Texto atual: "${select.options[select.selectedIndex]?.text || 'N/A'}"`, 'info');
                
                // Mostrar todas as opções
                for (let i = 0; i < select.options.length; i++) {
                    const option = select.options[i];
                    log(`  Opção ${i}: "${option.text}" (valor: "${option.value}")`, 'info');
                }
            } else {
                log('❌ Select principal não encontrado', 'error');
                
                // Procurar outros selects
                const selects = document.querySelectorAll('select');
                log(`🔍 Encontrados ${selects.length} selects no total:`, 'warning');
                selects.forEach((s, i) => {
                    log(`  ${i + 1}. name="${s.name}" id="${s.id}"`, 'info');
                });
            }
        }

        function testarFuncoes() {
            log('🔧 Testando funções...');
            
            const funcoes = [
                'carregarDisciplinasDisponiveis',
                'carregarDisciplinas',
                'carregarDisciplinasEmSelect',
                'disciplinasDisponiveis'
            ];
            
            funcoes.forEach(funcao => {
                if (typeof window[funcao] === 'function') {
                    log(`✅ Função ${funcao} encontrada`, 'success');
                } else if (typeof window[funcao] === 'object') {
                    log(`📊 Variável ${funcao} encontrada: ${Array.isArray(window[funcao]) ? window[funcao].length : 'objeto'}`, 'info');
                } else {
                    log(`❌ ${funcao} não encontrada`, 'error');
                }
            });
        }

        function forcarCarregamento() {
            log('▶️ Forçando carregamento...');
            
            if (typeof carregarDisciplinasDisponiveis === 'function') {
                log('🔧 Executando carregarDisciplinasDisponiveis()...');
                carregarDisciplinasDisponiveis();
            } else {
                log('❌ Função carregarDisciplinasDisponiveis não encontrada', 'error');
                
                // Tentar carregar manualmente
                log('🔧 Tentando carregar manualmente...');
                fetch('/cfc-bom-conselho/admin/api/disciplinas-clean.php?acao=listar')
                    .then(response => response.json())
                    .then(data => {
                        if (data.sucesso && data.disciplinas) {
                            log(`📊 Carregadas ${data.disciplinas.length} disciplinas manualmente`, 'success');
                            
                            // Tentar popular o select
                            const select = document.querySelector('select[name="disciplina_0"]');
                            if (select) {
                                select.innerHTML = '<option value="">Selecione a disciplina...</option>';
                                data.disciplinas.forEach(d => {
                                    const option = document.createElement('option');
                                    option.value = d.id;
                                    option.textContent = d.nome;
                                    select.appendChild(option);
                                });
                                log('✅ Select populado manualmente', 'success');
                            }
                        }
                    })
                    .catch(error => {
                        log(`❌ Erro: ${error.message}`, 'error');
                    });
            }
        }

        // Executar testes automáticos
        window.addEventListener('load', function() {
            log('📄 Página de debug carregada', 'success');
            log('ℹ️ Abra a página turmas-teoricas e execute os testes', 'info');
        });
    </script>
</body>
</html>
