<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Fun√ß√£o Contador Regressivo</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f8f9fa; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .success { color: #28a745; font-weight: bold; }
        .error { color: #dc3545; font-weight: bold; }
        .warning { color: #ffc107; font-weight: bold; }
        .info { color: #17a2b8; font-weight: bold; }
        .btn { padding: 8px 16px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .form-control { padding: 8px; border: 1px solid #ced4da; border-radius: 4px; margin: 5px; }
        .form-select { padding: 8px; border: 1px solid #ced4da; border-radius: 4px; margin: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Teste - Fun√ß√£o Contador Regressivo</h1>
        
        <div>
            <label>Tipo de Curso:</label>
            <select id="curso_tipo" class="form-select">
                <option value="">Selecione o curso...</option>
                <option value="formacao_45h">Forma√ß√£o 45h</option>
                <option value="formacao_acc_20h">Forma√ß√£o ACC 20h</option>
                <option value="reciclagem_infrator">Reciclagem Infrator</option>
                <option value="atualizacao">Atualiza√ß√£o</option>
            </select>
        </div>
        
        <div>
            <label>Total de horas: <span id="total-horas-disciplinas" style="color: #007bff; font-size: 1.2em;">0h</span></label>
        </div>
        
        <button class="btn btn-primary" onclick="testarFuncao()">üß™ Testar Fun√ß√£o</button>
        <button class="btn btn-success" onclick="testarCenario()">üìä Testar Cen√°rio</button>
        
        <div id="resultado" style="margin-top: 20px;"></div>
    </div>

    <script>
        // Copiar as fun√ß√µes exatas do arquivo principal
        function obterCargaHorariaCurso(tipoCurso) {
            const cargasHorarias = {
                'formacao_45h': 45,
                'formacao_acc_20h': 20,
                'reciclagem_infrator': 30,
                'atualizacao': 15
            };
            
            const cargaHoraria = cargasHorarias[tipoCurso] || 0;
            console.log(`üìä Carga hor√°ria do curso ${tipoCurso}: ${cargaHoraria}h`);
            return cargaHoraria;
        }

        function atualizarTotalHorasRegressivo() {
            console.log('üîÑ Atualizando total de horas (contador regressivo)...');
            
            const cursoSelect = document.getElementById('curso_tipo');
            const totalHorasElement = document.getElementById('total-horas-disciplinas');
            
            if (!cursoSelect || !totalHorasElement) {
                console.error('‚ùå Elementos n√£o encontrados para contador regressivo');
                return;
            }
            
            const tipoCurso = cursoSelect.value;
            if (!tipoCurso) {
                console.log('‚ÑπÔ∏è Nenhum curso selecionado');
                totalHorasElement.textContent = '0h';
                return;
            }
            
            // Obter carga hor√°ria total do curso
            const cargaHorariaTotal = obterCargaHorariaCurso(tipoCurso);
            
            // Calcular horas j√° utilizadas pelas disciplinas selecionadas
            let horasUtilizadas = 0;
            const disciplinas = document.querySelectorAll('.disciplina-item');
            
            disciplinas.forEach(item => {
                const select = item.querySelector('select');
                if (select && select.value) {
                    const selectedOption = select.options[select.selectedIndex];
                    const horasDisciplina = parseInt(selectedOption.dataset.aulas) || 0;
                    horasUtilizadas += horasDisciplina;
                    console.log(`üìö Disciplina ${selectedOption.textContent}: ${horasDisciplina}h`);
                }
            });
            
            // Calcular horas restantes
            const horasRestantes = Math.max(0, cargaHorariaTotal - horasUtilizadas);
            
            // Atualizar exibi√ß√£o
            totalHorasElement.textContent = `${horasRestantes}h`;
            
            // Armazenar valores para uso posterior
            window.cargaHorariaTotalCurso = cargaHorariaTotal;
            window.horasUtilizadasDisciplinas = horasUtilizadas;
            
            console.log(`üìä Total: ${cargaHorariaTotal}h - Utilizadas: ${horasUtilizadas}h = Restantes: ${horasRestantes}h`);
            
            // Feedback visual baseado no status
            if (horasRestantes === 0) {
                totalHorasElement.style.color = '#28a745'; // Verde - curso completo
                totalHorasElement.title = '‚úÖ Curso completo!';
            } else if (horasRestantes <= cargaHorariaTotal * 0.2) {
                totalHorasElement.style.color = '#ffc107'; // Amarelo - quase completo
                totalHorasElement.title = `‚ö†Ô∏è Faltam apenas ${horasRestantes}h para completar o curso`;
            } else {
                totalHorasElement.style.color = '#007bff'; // Azul - normal
                totalHorasElement.title = `${horasRestantes}h restantes de ${cargaHorariaTotal}h`;
            }
            
            return {
                cargaHorariaTotal,
                horasUtilizadas,
                horasRestantes,
                status: horasRestantes === 0 ? 'completo' : horasRestantes <= cargaHorariaTotal * 0.2 ? 'quase_completo' : 'normal'
            };
        }

        function testarFuncao() {
            const resultado = document.getElementById('resultado');
            resultado.innerHTML = '<div class="info">üß™ Testando fun√ß√£o...</div>';
            
            try {
                const resultadoFuncao = atualizarTotalHorasRegressivo();
                resultado.innerHTML = `
                    <div class="success">
                        ‚úÖ Fun√ß√£o executada com sucesso!<br>
                        Resultado: ${JSON.stringify(resultadoFuncao, null, 2)}
                    </div>
                `;
            } catch (error) {
                resultado.innerHTML = `
                    <div class="error">
                        ‚ùå Erro na fun√ß√£o: ${error.message}
                    </div>
                `;
            }
        }

        function testarCenario() {
            const resultado = document.getElementById('resultado');
            
            // Simular sele√ß√£o de curso
            document.getElementById('curso_tipo').value = 'formacao_45h';
            
            resultado.innerHTML = '<div class="info">üìä Testando cen√°rio: Curso 45h selecionado...</div>';
            
            setTimeout(() => {
                const resultadoFuncao = atualizarTotalHorasRegressivo();
                resultado.innerHTML = `
                    <div class="success">
                        ‚úÖ Cen√°rio testado com sucesso!<br>
                        Curso: Forma√ß√£o 45h<br>
                        Total de horas: ${resultadoFuncao.horasRestantes}h (esperado: 45h)<br>
                        Status: ${resultadoFuncao.status}
                    </div>
                `;
            }, 100);
        }

        // Teste autom√°tico ao carregar
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üß™ P√°gina de teste carregada!');
            console.log('üîß Fun√ß√£o atualizarTotalHorasRegressivo dispon√≠vel:', typeof atualizarTotalHorasRegressivo === 'function');
            
            // Teste r√°pido
            setTimeout(() => {
                document.getElementById('curso_tipo').value = 'formacao_45h';
                atualizarTotalHorasRegressivo();
            }, 500);
        });
    </script>
</body>
</html>
