<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - Contador Subtra√ß√£o</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f8f9fa; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .success { color: #28a745; font-weight: bold; }
        .error { color: #dc3545; font-weight: bold; }
        .info { color: #17a2b8; font-weight: bold; }
        .btn { padding: 8px 16px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: black; }
        .form-select { padding: 8px; border: 1px solid #ced4da; border-radius: 4px; margin: 5px; width: 100%; }
        .disciplina-item { border: 1px solid #ddd; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .debug-info { background: #f8f9fa; padding: 10px; margin: 10px 0; border-radius: 5px; border-left: 4px solid #007bff; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Debug - Contador Subtra√ß√£o</h1>
        
        <div class="debug-info">
            <h3>üìã Teste:</h3>
            <p>1. Selecione um curso (45h ou 20h)</p>
            <p>2. Selecione uma disciplina</p>
            <p>3. Verifique se o total diminui</p>
        </div>

        <div>
            <label><strong>Tipo de Curso:</strong></label>
            <select id="curso_tipo" class="form-select" onchange="debugAtualizarTotal()">
                <option value="">Selecione o curso...</option>
                <option value="formacao_45h">Forma√ß√£o 45h</option>
                <option value="formacao_acc_20h">Forma√ß√£o ACC 20h</option>
            </select>
        </div>
        
        <div class="disciplina-item">
            <h4>Disciplina 1</h4>
            <select class="form-select" name="disciplina_0" onchange="debugAtualizarDisciplina(0)">
                <option value="">Selecione a disciplina...</option>
                <option value="1" data-aulas="20" data-cor="#007bff">Disciplina A - 20h</option>
                <option value="2" data-aulas="15" data-cor="#28a745">Disciplina B - 15h</option>
                <option value="3" data-aulas="10" data-cor="#ffc107">Disciplina C - 10h</option>
            </select>
        </div>
        
        <div class="disciplina-item">
            <h4>Disciplina 2</h4>
            <select class="form-select" name="disciplina_1" onchange="debugAtualizarDisciplina(1)">
                <option value="">Selecione a disciplina...</option>
                <option value="4" data-aulas="25" data-cor="#dc3545">Disciplina D - 25h</option>
                <option value="5" data-aulas="30" data-cor="#6f42c1">Disciplina E - 30h</option>
            </select>
        </div>
        
        <div style="margin: 15px 0; padding: 15px; background: #e9ecef; border-radius: 5px;">
            <strong>Total de horas: <span id="total-horas-disciplinas" style="color: #007bff; font-size: 1.2em;">0h</span></strong>
        </div>
        
        <div>
            <button class="btn btn-primary" onclick="debugAtualizarTotal()">üîÑ Atualizar Total</button>
            <button class="btn btn-success" onclick="debugTestar()">üß™ Testar L√≥gica</button>
            <button class="btn btn-warning" onclick="debugLimpar()">üóëÔ∏è Limpar</button>
        </div>
        
        <div id="debug-log" style="margin-top: 20px; max-height: 300px; overflow-y: auto; background: #f8f9fa; padding: 10px; border-radius: 5px; font-family: monospace; font-size: 12px;"></div>
    </div>

    <script>
        let debugLog = [];

        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}`;
            debugLog.push(logMessage);
            console.log(logMessage);
            
            const logElement = document.getElementById('debug-log');
            logElement.innerHTML = debugLog.join('<br>');
            logElement.scrollTop = logElement.scrollHeight;
        }

        function obterCargaHorariaCurso(tipoCurso) {
            const cargasHorarias = {
                'formacao_45h': 45,
                'formacao_acc_20h': 20,
                'reciclagem_infrator': 30,
                'atualizacao': 15
            };
            return cargasHorarias[tipoCurso] || 0;
        }

        function debugAtualizarDisciplina(disciplinaId) {
            log(`üîß Atualizando disciplina ${disciplinaId}...`);
            
            const select = document.querySelector(`select[name="disciplina_${disciplinaId}"]`);
            if (!select) {
                log(`‚ùå Select n√£o encontrado para disciplina ${disciplinaId}`);
                return;
            }
            
            const selectedOption = select.options[select.selectedIndex];
            if (selectedOption.value) {
                const horas = selectedOption.dataset.aulas;
                log(`‚úÖ Disciplina ${disciplinaId} selecionada: ${selectedOption.textContent} (${horas}h)`);
            } else {
                log(`üóëÔ∏è Disciplina ${disciplinaId} desmarcada`);
            }
            
            // Chamar atualiza√ß√£o do total
            debugAtualizarTotal();
        }

        function debugAtualizarTotal() {
            log('üîÑ Atualizando total de horas...');
            
            const cursoSelect = document.getElementById('curso_tipo');
            const totalHorasElement = document.getElementById('total-horas-disciplinas');
            
            if (!cursoSelect || !totalHorasElement) {
                log('‚ùå Elementos n√£o encontrados');
                return;
            }
            
            const tipoCurso = cursoSelect.value;
            if (!tipoCurso) {
                log('‚ÑπÔ∏è Nenhum curso selecionado');
                totalHorasElement.textContent = '0';
                return;
            }
            
            // Obter carga hor√°ria total do curso
            const cargaHorariaTotal = obterCargaHorariaCurso(tipoCurso);
            log(`üìä Carga hor√°ria total do curso: ${cargaHorariaTotal}h`);
            
            // Calcular horas j√° utilizadas pelas disciplinas selecionadas
            let horasUtilizadas = 0;
            const disciplinas = document.querySelectorAll('.disciplina-item');
            log(`üîç Encontrados ${disciplinas.length} disciplina-items`);
            
            disciplinas.forEach(function(item, index) {
                const select = item.querySelector('select');
                if (select && select.value) {
                    const selectedOption = select.options[select.selectedIndex];
                    const horasDisciplina = parseInt(selectedOption.dataset.aulas) || 0;
                    horasUtilizadas += horasDisciplina;
                    log(`üìö Disciplina ${index}: ${selectedOption.textContent} = ${horasDisciplina}h`);
                }
            });
            
            // Calcular horas restantes
            const horasRestantes = Math.max(0, cargaHorariaTotal - horasUtilizadas);
            
            // Atualizar exibi√ß√£o
            totalHorasElement.textContent = horasRestantes;
            
            log(`üìä C√°lculo: ${cargaHorariaTotal}h (total) - ${horasUtilizadas}h (utilizadas) = ${horasRestantes}h (restantes)`);
            
            // Feedback visual
            if (horasRestantes === 0) {
                totalHorasElement.style.color = '#28a745';
                log('‚úÖ Curso completo!');
            } else if (horasRestantes <= cargaHorariaTotal * 0.2) {
                totalHorasElement.style.color = '#ffc107';
                log(`‚ö†Ô∏è Faltam apenas ${horasRestantes}h para completar`);
            } else {
                totalHorasElement.style.color = '#007bff';
                log(`‚ÑπÔ∏è ${horasRestantes}h restantes`);
            }
        }

        function debugTestar() {
            log('üß™ Iniciando teste completo...');
            
            // Teste 1: Curso 45h
            document.getElementById('curso_tipo').value = 'formacao_45h';
            log('1Ô∏è‚É£ Selecionando curso Forma√ß√£o 45h');
            debugAtualizarTotal();
            
            // Teste 2: Adicionar disciplina de 20h
            setTimeout(() => {
                document.querySelector('select[name="disciplina_0"]').value = '1';
                log('2Ô∏è‚É£ Selecionando Disciplina A (20h)');
                debugAtualizarDisciplina(0);
            }, 1000);
            
            // Teste 3: Adicionar outra disciplina de 15h
            setTimeout(() => {
                document.querySelector('select[name="disciplina_1"]').value = '2';
                log('3Ô∏è‚É£ Selecionando Disciplina B (15h)');
                debugAtualizarDisciplina(1);
            }, 2000);
        }

        function debugLimpar() {
            log('üóëÔ∏è Limpando sele√ß√µes...');
            document.getElementById('curso_tipo').value = '';
            document.querySelectorAll('.disciplina-item select').forEach(select => {
                select.value = '';
            });
            document.getElementById('total-horas-disciplinas').textContent = '0';
            debugLog = [];
            document.getElementById('debug-log').innerHTML = '';
        }

        // Teste autom√°tico ao carregar
        document.addEventListener('DOMContentLoaded', function() {
            log('üöÄ Sistema de debug carregado!');
            
            // Teste autom√°tico
            setTimeout(() => {
                log('üîÑ Iniciando teste autom√°tico...');
                debugTestar();
            }, 1000);
        });
    </script>
</body>
</html>
