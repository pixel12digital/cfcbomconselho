<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Sidebar Flyout - Sistema CFC</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="assets/css/layout.css" rel="stylesheet">
    <link href="assets/css/sidebar-icons.css" rel="stylesheet">
    <link href="assets/css/menu-flyout.css" rel="stylesheet">
    <link href="assets/css/sidebar-fixes.css" rel="stylesheet">
    <link href="assets/css/topbar-unified.css" rel="stylesheet">
    <link href="assets/css/layout-fixes.css" rel="stylesheet">
    <style>
        body {
            font-family: sans-serif;
            margin: 0;
            padding-top: 64px;
            background-color: #f0f2f5;
        }
        .content {
            padding: 20px;
            margin-left: 70px;
            background-color: #ffffff;
            min-height: calc(100vh - 64px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-radius: 8px;
            margin-top: 20px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
        .test-button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background-color: #2980b9;
        }
        .log {
            background-color: #2c3e50;
            color: #ffffff;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 10px;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-success { background-color: #2ecc71; }
        .status-warning { background-color: #f39c12; }
        .status-error { background-color: #e74c3c; }
    </style>
</head>
<body>
    <!-- Topbar Completa -->
    <div class="topbar" id="main-topbar">
        <!-- Logo -->
        <a href="?page=dashboard" class="topbar-logo">
            <div class="topbar-logo-icon">
                <i class="fas fa-car"></i>
            </div>
            <div class="topbar-logo-text">CFC Bom Conselho</div>
        </a>
        
        <!-- Busca Global -->
        <div class="topbar-search">
            <div class="search-input-wrapper">
                <input 
                    type="text" 
                    class="search-input" 
                    placeholder="Pesquisar por nome, CPF, matrícula, telefone..."
                    autocomplete="off"
                    aria-label="Busca global"
                >
                <i class="fas fa-search search-icon"></i>
                <div class="search-results" id="search-results" role="listbox" aria-label="Resultados da pesquisa"></div>
            </div>
        </div>
        
        <!-- Notificações e Perfil (Direita) -->
        <div class="topbar-right">
            <!-- Notificações -->
            <div class="topbar-notifications">
                <button class="notification-icon" aria-label="Notificações">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge hidden" id="notification-badge">0</span>
                </button>
                <div class="notification-dropdown" id="notification-dropdown">
                    <div class="notification-header">
                        <h3 class="notification-title">Notificações</h3>
                    </div>
                    <div class="notification-list" id="notification-list">
                        <div class="search-loading">Carregando notificações...</div>
                    </div>
                    <div class="notification-footer">
                        <div class="notification-actions">
                            <button class="notification-btn" id="mark-all-read">Marcar todas como lidas</button>
                            <a href="?page=notifications" class="notification-btn">Ver todas</a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Perfil do Usuário -->
            <div class="topbar-profile">
                <button class="profile-button" id="profile-button" aria-label="Perfil do usuário">
                    <div class="profile-avatar" id="profile-avatar">A</div>
                    <div class="profile-info">
                        <div class="profile-name" id="profile-name">Administrador</div>
                        <div class="profile-role" id="profile-role">Sistema</div>
                    </div>
                    <i class="fas fa-chevron-down profile-dropdown-icon"></i>
                </button>
                <div class="profile-dropdown" id="profile-dropdown">
                    <a href="?page=profile" class="profile-dropdown-item">
                        <i class="fas fa-user profile-dropdown-icon-item"></i>
                        Meu Perfil
                    </a>
                    <a href="?page=change-password" class="profile-dropdown-item">
                        <i class="fas fa-key profile-dropdown-icon-item"></i>
                        Trocar senha
                    </a>
                    <a href="logout.php" class="profile-dropdown-item logout">
                        <i class="fas fa-sign-out-alt profile-dropdown-icon-item"></i>
                        Sair
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Sidebar de Navegação -->
    <nav class="admin-sidebar">
        <div class="sidebar-header">
            <div class="sidebar-title">Navegação</div>
        </div>
        
        <div class="sidebar-nav">
            <!-- Dashboard -->
            <div class="nav-item">
                <a href="?page=dashboard" class="nav-link <?php echo $page === 'dashboard' ? 'active' : ''; ?>" title="Dashboard">
                    <div class="nav-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                </a>
            </div>
            
            <!-- Cadastros -->
            <div class="nav-item nav-group">
                <div class="nav-link nav-toggle" data-group="cadastros" title="Cadastros">
                    <div class="nav-icon">
                        <i class="fas fa-database"></i>
                    </div>
                    <div class="nav-arrow">
                        <i class="fas fa-chevron-down"></i>
                    </div>
                </div>
                <div class="nav-submenu" id="cadastros">
                    <a href="index.php?page=usuarios&action=list" class="nav-sublink">
                        <i class="fas fa-users"></i>
                        <span>Usuários</span>
                    </a>
                    <a href="index.php?page=cfcs&action=list" class="nav-sublink">
                        <i class="fas fa-building"></i>
                        <span>CFCs</span>
                    </a>
                    <a href="index.php?page=alunos&action=list" class="nav-sublink">
                        <i class="fas fa-graduation-cap"></i>
                        <span>Alunos</span>
                    </a>
                    <a href="index.php?page=instrutores&action=list" class="nav-sublink">
                        <i class="fas fa-chalkboard-teacher"></i>
                        <span>Instrutores</span>
                    </a>
                    <a href="index.php?page=veiculos&action=list" class="nav-sublink">
                        <i class="fas fa-car"></i>
                        <span>Veículos</span>
                    </a>
                </div>
            </div>
            
            <!-- Operacional -->
            <div class="nav-item nav-group">
                <div class="nav-link nav-toggle" data-group="operacional" title="Operacional">
                    <div class="nav-icon">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <div class="nav-arrow">
                        <i class="fas fa-chevron-down"></i>
                    </div>
                </div>
                <div class="nav-submenu" id="operacional">
                    <a href="index.php?page=agendamento" class="nav-sublink">
                        <i class="fas fa-calendar-plus"></i>
                        <span>Agendamento</span>
                    </a>
                    <a href="index.php?page=aulas" class="nav-sublink">
                        <i class="fas fa-clock"></i>
                        <span>Aulas</span>
                    </a>
                </div>
            </div>
            
            <!-- Relatórios -->
            <div class="nav-item nav-group">
                <div class="nav-link nav-toggle" data-group="relatorios" title="Relatórios">
                    <div class="nav-icon">
                        <i class="fas fa-chart-bar"></i>
                    </div>
                    <div class="nav-arrow">
                        <i class="fas fa-chevron-down"></i>
                    </div>
                </div>
                <div class="nav-submenu" id="relatorios">
                    <a href="index.php?page=relatorios&action=alunos" class="nav-sublink">
                        <i class="fas fa-graduation-cap"></i>
                        <span>Relatório de Alunos</span>
                    </a>
                    <a href="index.php?page=relatorios&action=aulas" class="nav-sublink">
                        <i class="fas fa-calendar-check"></i>
                        <span>Relatório de Aulas</span>
                    </a>
                </div>
            </div>
            
            <!-- Configurações -->
            <div class="nav-item nav-group">
                <div class="nav-link nav-toggle" data-group="configuracoes" title="Configurações">
                    <div class="nav-icon">
                        <i class="fas fa-cogs"></i>
                    </div>
                    <div class="nav-arrow">
                        <i class="fas fa-chevron-down"></i>
                    </div>
                </div>
                <div class="nav-submenu" id="configuracoes">
                    <a href="index.php?page=configuracoes-categorias" class="nav-sublink">
                        <i class="fas fa-layer-group"></i>
                        <span>Categorias de Habilitação</span>
                    </a>
                </div>
            </div>
            
            <!-- Ferramentas -->
            <div class="nav-item nav-group">
                <div class="nav-link nav-toggle" data-group="ferramentas" title="Ferramentas">
                    <div class="nav-icon">
                        <i class="fas fa-tools"></i>
                    </div>
                    <div class="nav-arrow">
                        <i class="fas fa-chevron-down"></i>
                    </div>
                </div>
                <div class="nav-submenu" id="ferramentas">
                    <a href="test-novas-regras-agendamento.php" class="nav-sublink" target="_blank">
                        <i class="fas fa-flask"></i>
                        <span>Teste Regras</span>
                    </a>
                </div>
            </div>
            
            <!-- Sair -->
            <div class="nav-item">
                <a href="logout.php" class="nav-link" title="Sair">
                    <div class="nav-icon">
                        <i class="fas fa-sign-out-alt"></i>
                    </div>
                </a>
            </div>
        </div>
    </nav>

    <div class="content">
        <h1>Teste Sidebar Flyout</h1>
        <p>Esta página testa o comportamento flyout da sidebar em todas as situações.</p>
        
        <div class="test-section">
            <h3><span class="status-indicator status-success"></span>Comportamento Flyout</h3>
            <p>Sidebar sempre compacta (70px) com flyouts que aparecem no hover.</p>
            <button class="test-button" onclick="testFlyoutBehavior()">Testar Flyout</button>
            <button class="test-button" onclick="testNoExpansion()">Testar Sem Expansão</button>
        </div>
        
        <div class="test-section">
            <h3><span class="status-indicator status-success"></span>Responsividade</h3>
            <p>Em telas ≤1024px, sidebar expande para 280px e flyouts são desabilitados.</p>
            <button class="test-button" onclick="testResponsive()">Testar Responsivo</button>
        </div>
        
        <div class="test-section">
            <h3><span class="status-indicator status-success"></span>Log de Testes</h3>
            <div class="log" id="test-log"></div>
            <button class="test-button" onclick="clearLog()">Limpar Log</button>
        </div>
    </div>

    <script src="assets/js/menu-flyout.js"></script>
    <script src="assets/js/topbar-unified.js"></script>
    
    <script>
        function log(message) {
            const logElement = document.getElementById('test-log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        function testFlyoutBehavior() {
            log('🔍 Testando comportamento flyout...');
            
            const sidebar = document.querySelector('.admin-sidebar');
            const flyouts = document.querySelectorAll('.nav-flyout');
            const navGroups = document.querySelectorAll('.nav-group');
            
            if (!sidebar) {
                log('❌ Sidebar não encontrada!');
                return;
            }
            
            const sidebarWidth = sidebar.offsetWidth;
            log(`📏 Largura da sidebar: ${sidebarWidth}px`);
            
            if (sidebarWidth === 70) {
                log('✅ Sidebar compacta (70px)');
            } else {
                log('❌ Sidebar não está compacta');
            }
            
            log(`📋 Flyouts encontrados: ${flyouts.length}`);
            log(`📋 Grupos de navegação: ${navGroups.length}`);
            
            if (flyouts.length > 0) {
                log('✅ Flyouts criados corretamente');
            } else {
                log('❌ Flyouts não foram criados');
            }
            
            // Testar se submenus estão ocultos
            const submenus = document.querySelectorAll('.nav-submenu');
            let hiddenSubmenus = 0;
            
            submenus.forEach(submenu => {
                const style = getComputedStyle(submenu);
                if (style.display === 'none' || style.visibility === 'hidden') {
                    hiddenSubmenus++;
                }
            });
            
            log(`📋 Submenus ocultos: ${hiddenSubmenus}/${submenus.length}`);
            
            if (hiddenSubmenus === submenus.length) {
                log('✅ Todos os submenus estão ocultos');
            } else {
                log('❌ Alguns submenus estão visíveis');
            }
        }
        
        function testNoExpansion() {
            log('🚫 Testando ausência de expansão interna...');
            
            const submenus = document.querySelectorAll('.nav-submenu');
            let hasExpansion = false;
            
            submenus.forEach(submenu => {
                const style = getComputedStyle(submenu);
                if (style.display !== 'none' && style.visibility !== 'hidden') {
                    hasExpansion = true;
                }
            });
            
            if (!hasExpansion) {
                log('✅ Nenhuma expansão interna detectada');
            } else {
                log('❌ Expansão interna detectada!');
            }
            
            // Testar se setas não são clicáveis
            const arrows = document.querySelectorAll('.nav-arrow');
            let clickableArrows = 0;
            
            arrows.forEach(arrow => {
                const style = getComputedStyle(arrow);
                if (style.pointerEvents !== 'none') {
                    clickableArrows++;
                }
            });
            
            log(`📋 Setas não clicáveis: ${arrows.length - clickableArrows}/${arrows.length}`);
            
            if (clickableArrows === 0) {
                log('✅ Setas não são clicáveis');
            } else {
                log('❌ Algumas setas são clicáveis');
            }
        }
        
        function testResponsive() {
            log('📱 Testando responsividade...');
            
            const sidebar = document.querySelector('.admin-sidebar');
            const currentWidth = window.innerWidth;
            
            log(`📏 Largura da janela: ${currentWidth}px`);
            
            if (currentWidth <= 1024) {
                log('📱 Modo mobile detectado');
                if (sidebar.offsetWidth === 280) {
                    log('✅ Sidebar expandida para mobile (280px)');
                } else {
                    log('❌ Sidebar não expandiu para mobile');
                }
            } else {
                log('🖥️ Modo desktop detectado');
                if (sidebar.offsetWidth === 70) {
                    log('✅ Sidebar compacta para desktop (70px)');
                } else {
                    log('❌ Sidebar não está compacta para desktop');
                }
            }
        }
        
        function clearLog() {
            document.getElementById('test-log').innerHTML = '';
        }
        
        // Log inicial
        log('🚀 Teste de Sidebar Flyout iniciado');
        log('📋 Aguardando inicialização dos scripts...');
        
        setTimeout(() => {
            log('✅ Scripts carregados');
            testFlyoutBehavior();
        }, 1000);
    </script>
</body>
</html>
