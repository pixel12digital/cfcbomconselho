<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üßπ Teste Cache Limpo</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        .btn { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .btn:hover { background: #0056b3; }
        .result { background: #f8f9fa; border: 1px solid #dee2e6; padding: 15px; margin: 10px 0; border-radius: 4px; font-family: monospace; white-space: pre-wrap; }
        .warning { background: #fff3cd; border-color: #ffeaa7; color: #856404; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üßπ Teste Cache Limpo - Modal Disciplinas</h1>
        
        <div class="result warning">
            <strong>‚ö†Ô∏è IMPORTANTE:</strong> Se o erro ainda persiste, pode ser cache do navegador.
            Execute os passos abaixo para for√ßar a limpeza completa.
        </div>
        
        <div>
            <button class="btn" onclick="limparCache()">üßπ Limpar Cache</button>
            <button class="btn" onclick="abrirPaginaLimpa()">üåê Abrir P√°gina Limpa</button>
            <button class="btn" onclick="verificarFuncoes()">üîç Verificar Fun√ß√µes</button>
        </div>
        
        <div id="resultado" class="result" style="display: none;"></div>
        
        <h2>üìã Passos para Limpar Cache:</h2>
        <ol>
            <li><strong>Pressione Ctrl + Shift + Delete</strong></li>
            <li>Selecione "Imagens e arquivos em cache"</li>
            <li>Clique em "Limpar dados"</li>
            <li>Feche todas as abas do site</li>
            <li>Abra uma nova aba e acesse: <code>admin/?page=turmas-teoricas&acao=nova&step=1</code></li>
            <li>Pressione <strong>Ctrl + F5</strong> para recarregar for√ßado</li>
        </ol>
        
        <h2>üîß Verifica√ß√£o Manual:</h2>
        <p>No console, execute:</p>
        <div class="result">
// Verificar se as fun√ß√µes existem
console.log('carregarDisciplinasModal:', typeof window.carregarDisciplinasModal);
console.log('carregarDisciplinas (formul√°rio):', typeof window.carregarDisciplinas);

// Verificar se h√° erros
console.log('Verificando erros...');
        </div>
    </div>

    <script>
        function log(mensagem) {
            const resultado = document.getElementById('resultado');
            resultado.style.display = 'block';
            resultado.textContent += new Date().toLocaleTimeString() + ': ' + mensagem + '\n';
            console.log(mensagem);
        }

        function limparCache() {
            log('üßπ Iniciando limpeza de cache...');
            
            // Tentar limpar cache programaticamente
            if ('caches' in window) {
                caches.keys().then(names => {
                    names.forEach(name => {
                        caches.delete(name);
                    });
                    log('‚úÖ Cache do Service Worker limpo');
                });
            }
            
            // Limpar localStorage
            localStorage.clear();
            log('‚úÖ localStorage limpo');
            
            // Limpar sessionStorage
            sessionStorage.clear();
            log('‚úÖ sessionStorage limpo');
            
            log('‚úÖ Limpeza conclu√≠da. Agora feche todas as abas e abra uma nova.');
        }

        function abrirPaginaLimpa() {
            const url = '../?page=turmas-teoricas&acao=nova&step=1&_t=' + Date.now();
            log('üåê Abrindo p√°gina com timestamp: ' + url);
            window.open(url, '_blank');
        }

        function verificarFuncoes() {
            log('üîç Verificando fun√ß√µes na p√°gina atual...');
            
            const novaJanela = window.open('../?page=turmas-teoricas&acao=nova&step=1&_t=' + Date.now(), '_blank');
            
            if (novaJanela) {
                setTimeout(() => {
                    novaJanela.eval(`
                        console.log('üîç [VERIFICA√á√ÉO] Verificando fun√ß√µes...');
                        
                        // Verificar fun√ß√µes do modal
                        console.log('carregarDisciplinasModal:', typeof window.carregarDisciplinasModal);
                        console.log('fecharModalDisciplinas:', typeof window.fecharModalDisciplinas);
                        console.log('abrirModalDisciplinasInterno:', typeof window.abrirModalDisciplinasInterno);
                        
                        // Verificar fun√ß√µes do formul√°rio
                        console.log('carregarDisciplinas (formul√°rio):', typeof window.carregarDisciplinas);
                        
                        // Verificar se h√° erros no console
                        console.log('üîç [VERIFICA√á√ÉO] Verifica√ß√£o conclu√≠da');
                    `);
                }, 2000);
            }
        }

        console.log('üßπ P√°gina de teste de cache carregada');
    </script>
</body>
</html>
