<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Frontend - Exclusão de Alunos</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .btn { padding: 10px 20px; margin: 10px; border: none; border-radius: 5px; cursor: pointer; }
        .btn-danger { background-color: #dc3545; color: white; }
        .alert { padding: 15px; margin: 15px 0; border-radius: 5px; }
        .alert-success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .alert-danger { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .alert-info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .loading { display: none; color: #007bff; font-weight: bold; }
    </style>
</head>
<body>
    <h1>Teste Frontend - Exclusão de Alunos</h1>
    
    <div id="resultado"></div>
    <div id="loading" class="loading">🔄 Processando...</div>
    
    <button class="btn btn-danger" onclick="testarExclusao()">
        🗑️ Testar Exclusão de Aluno (ID: 105)
    </button>
    
    <script>
        function mostrarResultado(mensagem, tipo = 'info') {
            const resultadoDiv = document.getElementById('resultado');
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${tipo}`;
            alertDiv.textContent = mensagem;
            
            resultadoDiv.appendChild(alertDiv);
            
            // Remover após 10 segundos
            setTimeout(() => {
                alertDiv.remove();
            }, 10000);
        }
        
        function mostrarLoading(mostrar) {
            const loadingDiv = document.getElementById('loading');
            loadingDiv.style.display = mostrar ? 'block' : 'none';
        }
        
        function testarExclusao() {
            const mensagem = '⚠️ ATENÇÃO: Esta ação não pode ser desfeita!\n\nDeseja realmente excluir este aluno?';
            
            if (confirm(mensagem)) {
                mostrarLoading(true);
                mostrarResultado('🔄 Iniciando exclusão...', 'info');
                
                // Simular exatamente o que o frontend faz
                fetch('admin/api/alunos.php', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ id: 105 })
                })
                .then(response => {
                    console.log('Response status:', response.status);
                    console.log('Response headers:', response.headers);
                    
                    // Verificar se a resposta é JSON válido
                    const contentType = response.headers.get('content-type');
                    if (contentType && contentType.includes('application/json')) {
                        return response.json();
                    } else {
                        // Se não for JSON, ler como texto para debug
                        return response.text().then(text => {
                            throw new Error(`Resposta não é JSON válido. Status: ${response.status}, Conteúdo: ${text}`);
                        });
                    }
                })
                .then(data => {
                    console.log('Response data:', data);
                    mostrarLoading(false);
                    
                    if (data.success) {
                        mostrarResultado('✅ Sucesso! ' + data.message, 'success');
                    } else {
                        mostrarResultado('❌ Erro: ' + (data.error || 'Erro desconhecido'), 'danger');
                        
                        // Mostrar informações de debug se disponíveis
                        if (data.debug) {
                            console.log('Debug info:', data.debug);
                            mostrarResultado('🔍 Debug: ' + JSON.stringify(data.debug), 'info');
                        }
                    }
                })
                .catch(error => {
                    console.error('Erro na requisição:', error);
                    mostrarLoading(false);
                    mostrarResultado('❌ Erro na requisição: ' + error.message, 'danger');
                });
            }
        }
        
        // Testar também com um ID que não existe
        function testarExclusaoInexistente() {
            const mensagem = '🧪 Testar exclusão de aluno inexistente (ID: 99999)?';
            
            if (confirm(mensagem)) {
                mostrarLoading(true);
                mostrarResultado('🔄 Testando exclusão de aluno inexistente...', 'info');
                
                fetch('admin/api/alunos.php', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ id: 99999 })
                })
                .then(response => response.json())
                .then(data => {
                    mostrarLoading(false);
                    if (data.success) {
                        mostrarResultado('✅ Sucesso inesperado! ' + data.message, 'success');
                    } else {
                        mostrarResultado('✅ Erro esperado: ' + (data.error || 'Erro desconhecido'), 'info');
                    }
                })
                .catch(error => {
                    mostrarLoading(false);
                    mostrarResultado('❌ Erro na requisição: ' + error.message, 'danger');
                });
            }
        }
        
        // Adicionar botão para testar aluno inexistente
        setTimeout(() => {
            const btn = document.createElement('button');
            btn.className = 'btn btn-danger';
            btn.textContent = '🧪 Testar Aluno Inexistente';
            btn.onclick = testarExclusaoInexistente;
            document.body.appendChild(btn);
        }, 1000);
    </script>
</body>
</html>
