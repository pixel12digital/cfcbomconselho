<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Campos de Data - Instrutor</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        .form-group { margin: 15px 0; }
        .form-label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-control { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; }
        .btn { padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        .btn-primary { background-color: #007bff; color: white; }
        .btn-secondary { background-color: #6c757d; color: white; }
        .log { background-color: #f8f9fa; padding: 10px; border-radius: 4px; margin: 10px 0; font-family: monospace; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.4); }
        .modal-content { background-color: #fefefe; margin: 5% auto; padding: 20px; border: 1px solid #888; width: 80%; max-width: 600px; border-radius: 8px; }
        .close { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
        .close:hover { color: black; }
    </style>
</head>
<body>
    <h1>üß™ Teste Campos de Data - Formul√°rio de Instrutor</h1>
    
    <div class="test-section info">
        <h3>üìç Teste dos Campos de Data</h3>
        <p>Este teste simula o formul√°rio de instrutor para verificar se os campos de data est√£o funcionando corretamente.</p>
    </div>

    <div class="test-section">
        <h3>üìù Formul√°rio de Teste</h3>
        
        <div class="form-group">
            <label for="nome" class="form-label">Nome Completo *</label>
            <input type="text" class="form-control" id="nome" name="nome" placeholder="Nome completo">
        </div>
        
        <div class="form-group">
            <label for="data_nascimento" class="form-label">Data de Nascimento *</label>
            <input type="date" class="form-control" id="data_nascimento" name="data_nascimento" required>
        </div>
        
        <div class="form-group">
            <label for="validade_credencial" class="form-label">Validade da Credencial</label>
            <input type="date" class="form-control" id="validade_credencial" name="validade_credencial">
        </div>
        
        <div class="form-group">
            <button class="btn btn-primary" onclick="testarCamposData()">üß™ Testar Campos</button>
            <button class="btn btn-secondary" onclick="limparCamposData()">üßπ Limpar Campos</button>
            <button class="btn btn-secondary" onclick="simularPreenchimento()">üìù Simular Preenchimento</button>
            <button class="btn btn-secondary" onclick="abrirModalTeste()">ü™ü Abrir Modal</button>
        </div>
    </div>

    <div class="test-section">
        <h3>üìä Resultados dos Testes</h3>
        <div id="resultados"></div>
    </div>

    <div class="test-section">
        <h3>üîç Log de Eventos</h3>
        <div id="log" class="log"></div>
    </div>

    <!-- Modal de Teste -->
    <div id="modalTeste" class="modal">
        <div class="modal-content">
            <span class="close" onclick="fecharModalTeste()">&times;</span>
            <h3>Modal de Teste - Campos de Data</h3>
            
            <div class="form-group">
                <label for="modal_data_nascimento" class="form-label">Data de Nascimento *</label>
                <input type="date" class="form-control" id="modal_data_nascimento" name="data_nascimento" required>
            </div>
            
            <div class="form-group">
                <label for="modal_validade_credencial" class="form-label">Validade da Credencial</label>
                <input type="date" class="form-control" id="modal_validade_credencial" name="validade_credencial">
            </div>
            
            <div class="form-group">
                <button class="btn btn-primary" onclick="testarCamposModal()">üß™ Testar no Modal</button>
                <button class="btn btn-secondary" onclick="limparCamposModal()">üßπ Limpar Modal</button>
            </div>
        </div>
    </div>

    <script>
        // Fun√ß√£o para adicionar log
        function adicionarLog(mensagem) {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${timestamp}] ${mensagem}<br>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        // Fun√ß√£o para validar se uma data √© v√°lida
        function isValidDate(dateString) {
            if (!dateString) return false;
            
            // Verificar formato yyyy-MM-dd
            const dateRegex = /^\d{4}-\d{2}-\d{2}$/;
            if (!dateRegex.test(dateString)) return false;
            
            // Verificar se √© uma data v√°lida
            const date = new Date(dateString);
            if (isNaN(date.getTime())) return false;
            
            // Verificar se a data n√£o √© muito antiga (antes de 1900)
            if (date.getFullYear() < 1900) return false;
            
            return true;
        }

        // Fun√ß√£o para configurar campos de data
        function configurarCamposData() {
            const camposData = ['data_nascimento', 'validade_credencial', 'modal_data_nascimento', 'modal_validade_credencial'];
            
            camposData.forEach(campoId => {
                const campo = document.getElementById(campoId);
                if (campo) {
                    // Garantir que seja do tipo date
                    campo.type = 'date';
                    
                    // Remover valores inv√°lidos
                    if (campo.value && !isValidDate(campo.value)) {
                        campo.value = '';
                    }
                    
                    // Adicionar event listener para validar formato
                    campo.addEventListener('change', function() {
                        if (this.value && !isValidDate(this.value)) {
                            console.warn(`Data inv√°lida no campo ${campoId}: ${this.value}`);
                            this.value = '';
                            adicionarLog(`‚ö†Ô∏è Data inv√°lida removida do campo ${campoId}`);
                        } else if (this.value) {
                            adicionarLog(`‚úÖ Data v√°lida definida no campo ${campoId}: ${this.value}`);
                        }
                    });
                    
                    // Adicionar event listener para input
                    campo.addEventListener('input', function() {
                        adicionarLog(`‚úèÔ∏è Input detectado no campo ${campoId}: "${this.value}"`);
                    });
                    
                    // Adicionar event listener para focus
                    campo.addEventListener('focus', function() {
                        adicionarLog(`üéØ Campo ${campoId} recebeu foco`);
                    });
                }
            });
        }

        // Fun√ß√£o para testar campos de data
        function testarCamposData() {
            const resultadosDiv = document.getElementById('resultados');
            resultadosDiv.innerHTML = '';
            
            adicionarLog('üß™ Iniciando teste dos campos de data...');
            
            const camposData = ['data_nascimento', 'validade_credencial'];
            let resultados = '<div class="success">';
            resultados += '<h4>‚úÖ Teste dos Campos de Data</h4>';
            
            camposData.forEach(campoId => {
                const campo = document.getElementById(campoId);
                if (campo) {
                    const tipo = campo.type;
                    const valor = campo.value;
                    const editavel = !campo.readOnly && !campo.disabled;
                    const valido = !valor || isValidDate(valor);
                    
                    resultados += `<p><strong>${campoId}:</strong></p>`;
                    resultados += `<ul>`;
                    resultados += `<li>Tipo: ${tipo}</li>`;
                    resultados += `<li>Valor: "${valor}"</li>`;
                    resultados += `<li>Edit√°vel: ${editavel}</li>`;
                    resultados += `<li>Data v√°lida: ${valido}</li>`;
                    resultados += `</ul>`;
                    
                    adicionarLog(`üìã Campo ${campoId}: tipo=${tipo}, valor="${valor}", edit√°vel=${editavel}, v√°lido=${valido}`);
                }
            });
            
            resultados += '</div>';
            resultadosDiv.innerHTML = resultados;
            
            adicionarLog('‚úÖ Teste conclu√≠do com sucesso!');
        }

        // Fun√ß√£o para limpar campos de data
        function limparCamposData() {
            const camposData = ['data_nascimento', 'validade_credencial'];
            
            camposData.forEach(campoId => {
                const campo = document.getElementById(campoId);
                if (campo) {
                    campo.value = '';
                    campo.type = 'date';
                    campo.removeAttribute('min');
                    campo.removeAttribute('max');
                    adicionarLog(`üßπ Campo ${campoId} limpo`);
                }
            });
        }

        // Fun√ß√£o para simular preenchimento
        function simularPreenchimento() {
            const hoje = new Date();
            const dataNascimento = new Date(1990, 0, 15); // 15/01/1990
            const validadeCredencial = new Date(hoje.getFullYear() + 2, hoje.getMonth(), hoje.getDate()); // 2 anos no futuro
            
            const campoDataNascimento = document.getElementById('data_nascimento');
            const campoValidadeCredencial = document.getElementById('validade_credencial');
            
            if (campoDataNascimento) {
                campoDataNascimento.value = dataNascimento.toISOString().split('T')[0];
                adicionarLog(`üìÖ Data de nascimento simulada: ${campoDataNascimento.value}`);
            }
            
            if (campoValidadeCredencial) {
                campoValidadeCredencial.value = validadeCredencial.toISOString().split('T')[0];
                adicionarLog(`üìÖ Validade da credencial simulada: ${campoValidadeCredencial.value}`);
            }
        }

        // Fun√ß√£o para abrir modal de teste
        function abrirModalTeste() {
            document.getElementById('modalTeste').style.display = 'block';
            adicionarLog('ü™ü Modal de teste aberto');
        }

        // Fun√ß√£o para fechar modal de teste
        function fecharModalTeste() {
            document.getElementById('modalTeste').style.display = 'none';
            adicionarLog('ü™ü Modal de teste fechado');
        }

        // Fun√ß√£o para testar campos no modal
        function testarCamposModal() {
            const resultadosDiv = document.getElementById('resultados');
            resultadosDiv.innerHTML = '<div class="info"><h4>üß™ Teste no Modal</h4><p>Verifique se os campos de data no modal est√£o funcionando corretamente.</p></div>';
            adicionarLog('üß™ Teste no modal iniciado');
        }

        // Fun√ß√£o para limpar campos do modal
        function limparCamposModal() {
            const camposData = ['modal_data_nascimento', 'modal_validade_credencial'];
            
            camposData.forEach(campoId => {
                const campo = document.getElementById(campoId);
                if (campo) {
                    campo.value = '';
                    campo.type = 'date';
                    adicionarLog(`üßπ Campo ${campoId} do modal limpo`);
                }
            });
        }

        // Fechar modal ao clicar fora
        window.onclick = function(event) {
            const modal = document.getElementById('modalTeste');
            if (event.target === modal) {
                fecharModalTeste();
            }
        }

        // Inicializar quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', function() {
            adicionarLog('üöÄ P√°gina de teste carregada');
            configurarCamposData();
            adicionarLog('üìã Campos de data configurados para testes');
        });
    </script>
</body>
</html>
